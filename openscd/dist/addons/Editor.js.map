{"version":3,"file":"Editor.js","sourceRoot":"","sources":["../../src/addons/Editor.ts"],"names":[],"mappings":"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","sourcesContent":["import { OpenEvent, newEditCompletedEvent } from '@openscd/core';\nimport {\n  property,\n  LitElement,\n  customElement,\n  TemplateResult,\n  html,\n} from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport {\n  Move,\n  Create,\n  Delete,\n  EditorAction,\n  EditorActionEvent,\n  SimpleAction,\n  Replace,\n  Update,\n} from '@openscd/core/foundation/deprecated/editor.js';\n\nimport { newLogEvent } from '@openscd/core/foundation/deprecated/history.js';\nimport { newValidateEvent } from '@openscd/core/foundation/deprecated/validation.js';\nimport { OpenDocEvent } from '@openscd/core/foundation/deprecated/open-event.js';\nimport { getReference, SCLTag } from '../foundation.js';\nimport {\n  isCreate,\n  isDelete,\n  isMove,\n  isSimple,\n  isReplace,\n  isUpdate,\n} from '@openscd/core/foundation/deprecated/editor.js';\n\n@customElement('oscd-editor')\nexport class OscdEditor extends LitElement {\n  /** The `XMLDocument` to be edited */\n  @property({ attribute: false })\n  doc: XMLDocument | null = null;\n  /** The name of the current [[`doc`]] */\n  @property({ type: String }) docName = '';\n  /** The UUID of the current [[`doc`]] */\n  @property({ type: String }) docId = '';\n\n  @property({\n    type: Object,\n  })\n  host!: HTMLElement;\n\n  @property({\n    type: Number,\n  })\n  editCount = -1;\n\n  private checkCreateValidity(create: Create): boolean {\n    if (create.checkValidity !== undefined) return create.checkValidity();\n\n    if (\n      !(create.new.element instanceof Element) ||\n      !(create.new.parent instanceof Element)\n    )\n      return true;\n\n    const invalidNaming =\n      create.new.element.hasAttribute('name') &&\n      Array.from(create.new.parent.children).some(\n        elm =>\n          elm.tagName === (<Element>create.new.element).tagName &&\n          elm.getAttribute('name') ===\n            (<Element>create.new.element).getAttribute('name')\n      );\n\n    if (invalidNaming) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.create', {\n            name: create.new.element.tagName,\n          }),\n          message: get('editing.error.nameClash', {\n            parent:\n              create.new.parent instanceof HTMLElement\n                ? create.new.parent.tagName\n                : 'Document',\n            child: create.new.element.tagName,\n            name: create.new.element.getAttribute('name')!,\n          }),\n        })\n      );\n\n      return false;\n    }\n\n    const invalidId =\n      create.new.element.hasAttribute('id') &&\n      Array.from(\n        create.new.parent.ownerDocument.querySelectorAll(\n          'LNodeType, DOType, DAType, EnumType'\n        )\n      ).some(\n        elm =>\n          elm.getAttribute('id') ===\n          (<Element>create.new.element).getAttribute('id')\n      );\n\n    if (invalidId) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.create', {\n            name: create.new.element.tagName,\n          }),\n          message: get('editing.error.idClash', {\n            id: create.new.element.getAttribute('id')!,\n          }),\n        })\n      );\n\n      return false;\n    }\n\n    return true;\n  }\n\n  private onCreate(action: Create) {\n    if (!this.checkCreateValidity(action)) return false;\n\n    if (\n      action.new.reference === undefined &&\n      action.new.element instanceof Element &&\n      action.new.parent instanceof Element\n    )\n      action.new.reference = getReference(\n        action.new.parent,\n        <SCLTag>action.new.element.tagName\n      );\n    else action.new.reference = action.new.reference ?? null;\n\n    action.new.parent.insertBefore(action.new.element, action.new.reference);\n    return true;\n  }\n\n  private logCreate(action: Create) {\n    const name =\n      action.new.element instanceof Element\n        ? action.new.element.tagName\n        : get('editing.node');\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'action',\n        title: get('editing.created', { name }),\n        action,\n      })\n    );\n  }\n\n  private onDelete(action: Delete) {\n    if (!action.old.reference)\n      action.old.reference = action.old.element.nextSibling;\n\n    if (action.old.element.parentNode !== action.old.parent) return false;\n\n    action.old.parent.removeChild(action.old.element);\n    return true;\n  }\n\n  private logDelete(action: Delete) {\n    const name =\n      action.old.element instanceof Element\n        ? action.old.element.tagName\n        : get('editing.node');\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'action',\n        title: get('editing.deleted', { name }),\n        action,\n      })\n    );\n  }\n\n  private checkMoveValidity(move: Move): boolean {\n    if (move.checkValidity !== undefined) return move.checkValidity();\n\n    const invalid =\n      move.old.element.hasAttribute('name') &&\n      move.new.parent !== move.old.parent &&\n      Array.from(move.new.parent.children).some(\n        elm =>\n          elm.tagName === move.old.element.tagName &&\n          elm.getAttribute('name') === move.old.element.getAttribute('name')\n      );\n\n    if (invalid)\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.move', {\n            name: move.old.element.tagName,\n          }),\n          message: get('editing.error.nameClash', {\n            parent: move.new.parent.tagName,\n            child: move.old.element.tagName,\n            name: move.old.element.getAttribute('name')!,\n          }),\n        })\n      );\n\n    return !invalid;\n  }\n\n  private onMove(action: Move) {\n    if (!this.checkMoveValidity(action)) return false;\n\n    if (!action.old.reference)\n      action.old.reference = action.old.element.nextSibling;\n\n    if (action.new.reference === undefined)\n      action.new.reference = getReference(\n        action.new.parent,\n        <SCLTag>action.old.element.tagName\n      );\n\n    action.new.parent.insertBefore(action.old.element, action.new.reference);\n    return true;\n  }\n\n  private logMove(action: Move) {\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'action',\n        title: get('editing.moved', {\n          name: action.old.element.tagName,\n        }),\n        action: action,\n      })\n    );\n  }\n\n  private checkReplaceValidity(replace: Replace): boolean {\n    if (replace.checkValidity !== undefined) return replace.checkValidity();\n\n    const invalidNaming =\n      replace.new.element.hasAttribute('name') &&\n      replace.new.element.getAttribute('name') !==\n        replace.old.element.getAttribute('name') &&\n      Array.from(replace.old.element.parentElement?.children ?? []).some(\n        elm =>\n          elm.tagName === replace.new.element.tagName &&\n          elm.getAttribute('name') === replace.new.element.getAttribute('name')\n      );\n\n    if (invalidNaming) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.update', {\n            name: replace.new.element.tagName,\n          }),\n          message: get('editing.error.nameClash', {\n            parent: replace.old.element.parentElement!.tagName,\n            child: replace.new.element.tagName,\n            name: replace.new.element.getAttribute('name')!,\n          }),\n        })\n      );\n\n      return false;\n    }\n\n    const invalidId =\n      replace.new.element.hasAttribute('id') &&\n      replace.new.element.getAttribute('id') !==\n        replace.old.element.getAttribute('id') &&\n      Array.from(\n        replace.new.element.ownerDocument.querySelectorAll(\n          'LNodeType, DOType, DAType, EnumType'\n        )\n      ).some(\n        elm =>\n          elm.getAttribute('id') ===\n          (<Element>replace.new.element).getAttribute('id')\n      );\n\n    if (invalidId) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.update', {\n            name: replace.new.element.tagName,\n          }),\n          message: get('editing.error.idClash', {\n            id: replace.new.element.getAttribute('id')!,\n          }),\n        })\n      );\n\n      return false;\n    }\n\n    return true;\n  }\n\n  private onReplace(action: Replace) {\n    if (!this.checkReplaceValidity(action)) return false;\n\n    action.new.element.append(...Array.from(action.old.element.children));\n    action.old.element.replaceWith(action.new.element);\n    return true;\n  }\n\n  private logUpdate(action: Replace | Update) {\n    const name = isReplace(action)\n      ? action.new.element.tagName\n      : (action as Update).element.tagName;\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'action',\n        title: get('editing.updated', {\n          name,\n        }),\n        action: action,\n      })\n    );\n  }\n\n  private checkUpdateValidity(update: Update): boolean {\n    if (update.checkValidity !== undefined) return update.checkValidity();\n\n    if (update.oldAttributes['name'] !== update.newAttributes['name']) {\n      const invalidNaming = Array.from(\n        update.element.parentElement?.children ?? []\n      ).some(\n        elm =>\n          elm.tagName === update.element.tagName &&\n          elm.getAttribute('name') === update.newAttributes['name']\n      );\n\n      if (invalidNaming) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.update', {\n              name: update.element.tagName,\n            }),\n            message: get('editing.error.nameClash', {\n              parent: update.element.parentElement!.tagName,\n              child: update.element.tagName,\n              name: update.newAttributes['name']!,\n            }),\n          })\n        );\n\n        return false;\n      }\n    }\n\n    const invalidId =\n      update.newAttributes['id'] &&\n      Array.from(\n        update.element.ownerDocument.querySelectorAll(\n          'LNodeType, DOType, DAType, EnumType'\n        )\n      ).some(elm => elm.getAttribute('id') === update.newAttributes['id']);\n\n    if (invalidId) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'error',\n          title: get('editing.error.update', {\n            name: update.element.tagName,\n          }),\n          message: get('editing.error.idClash', {\n            id: update.newAttributes['id']!,\n          }),\n        })\n      );\n\n      return false;\n    }\n\n    return true;\n  }\n\n  private onUpdate(action: Update) {\n    if (!this.checkUpdateValidity(action)) return false;\n\n    Array.from(action.element.attributes).forEach(attr =>\n      action.element.removeAttributeNode(attr)\n    );\n\n    Object.entries(action.newAttributes).forEach(([key, value]) => {\n      if (value !== null && value !== undefined)\n        action.element.setAttribute(key, value);\n    });\n\n    return true;\n  }\n\n  private onSimpleAction(action: SimpleAction) {\n    if (isMove(action)) return this.onMove(action as Move);\n    else if (isCreate(action)) return this.onCreate(action as Create);\n    else if (isDelete(action)) return this.onDelete(action as Delete);\n    else if (isReplace(action)) return this.onReplace(action as Replace);\n    else if (isUpdate(action)) return this.onUpdate(action as Update);\n  }\n\n  private logSimpleAction(action: SimpleAction) {\n    if (isMove(action)) this.logMove(action as Move);\n    else if (isCreate(action)) this.logCreate(action as Create);\n    else if (isDelete(action)) this.logDelete(action as Delete);\n    else if (isReplace(action)) this.logUpdate(action as Replace);\n    else if (isUpdate(action)) this.logUpdate(action as Update);\n  }\n\n  private async onAction(event: EditorActionEvent<EditorAction>) {\n    if (isSimple(event.detail.action)) {\n      if (this.onSimpleAction(event.detail.action))\n        this.logSimpleAction(event.detail.action);\n    } else if (event.detail.action.actions.length > 0) {\n      event.detail.action.actions.forEach(element =>\n        this.onSimpleAction(element)\n      );\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'action',\n          title: event.detail.action.title,\n          action: event.detail.action,\n        })\n      );\n    } else return;\n\n    if (!this.doc) return;\n\n    await this.updateComplete;\n    this.dispatchEvent(newValidateEvent());\n    this.dispatchEvent(\n      newEditCompletedEvent(event.detail.action, event.detail.initiator)\n    );\n  }\n\n  /**\n   *\n   * @deprecated [Move to handleOpenDoc instead]\n   */\n  private async onOpenDoc(event: OpenDocEvent) {\n    this.doc = event.detail.doc;\n    this.docName = event.detail.docName;\n    this.docId = event.detail.docId ?? '';\n\n    await this.updateComplete;\n\n    this.dispatchEvent(newValidateEvent());\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'info',\n        title: get('openSCD.loaded', { name: this.docName }),\n      })\n    );\n  }\n\n  handleOpenDoc({ detail: { docName, doc } }: OpenEvent) {\n    this.doc = doc;\n    this.docName = docName;\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n\n    this.host.addEventListener('editor-action', this.onAction.bind(this));\n    this.host.addEventListener('open-doc', this.onOpenDoc);\n    this.host.addEventListener('oscd-open', this.handleOpenDoc);\n  }\n\n  render(): TemplateResult {\n    return html`<slot></slot>`;\n  }\n}\n"]}