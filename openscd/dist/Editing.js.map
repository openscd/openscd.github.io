{"version":3,"file":"Editing.js","sourceRoot":"","sources":["../src/Editing.ts"],"names":[],"mappings":"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","sourcesContent":["import { OpenEvent } from '@openscd/core';\nimport { property } from 'lit-element';\nimport { get } from 'lit-translate';\n\nimport { newLogEvent } from '@openscd/core/foundation/deprecated/history.js';\nimport { newValidateEvent } from '@openscd/core/foundation/deprecated/validation.js'\nimport { \n  Create, \n  Delete, \n  Move, \n  Update, \n  Replace, \n  SimpleAction,\n  EditorAction,\n  EditorActionEvent,\n  isCreate,\n  isDelete,\n  isMove,\n  isSimple,\n  isReplace,\n  isUpdate,\n} from '@openscd/core/foundation/deprecated/editor.js';\nimport { OpenDocEvent } from '@openscd/core/foundation/deprecated/open-event.js';\nimport {\n  getReference,\n  SCLTag,\n  Mixin,\n  LitElementConstructor\n} from './foundation.js';\n\n/** Mixin that edits an `XML` `doc`, listening to [[`EditorActionEvent`]]s */\nexport type EditingElement = Mixin<typeof Editing>;\n\n/** @typeParam TBase - a type extending `LitElement`\n * @returns `Base` with an `XMLDocument` property \"`doc`\" and an event listener\n * applying [[`EditorActionEvent`]]s and dispatching [[`LogEvent`]]s. */\nexport function Editing<TBase extends LitElementConstructor>(Base: TBase) {\n  class EditingElement extends Base {\n    /** The `XMLDocument` to be edited */\n    @property({ attribute: false })\n    doc: XMLDocument | null = null;\n    /** The name of the current [[`doc`]] */\n    @property({ type: String }) docName = '';\n    /** The UUID of the current [[`doc`]] */\n    @property({ type: String }) docId = '';\n\n    private checkCreateValidity(create: Create): boolean {\n      if (create.checkValidity !== undefined) return create.checkValidity();\n\n      if (\n        !(create.new.element instanceof Element) ||\n        !(create.new.parent instanceof Element)\n      )\n        return true;\n\n      const invalidNaming =\n        create.new.element.hasAttribute('name') &&\n        Array.from(create.new.parent.children).some(\n          elm =>\n            elm.tagName === (<Element>create.new.element).tagName &&\n            elm.getAttribute('name') ===\n              (<Element>create.new.element).getAttribute('name')\n        );\n\n      if (invalidNaming) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.create', {\n              name: create.new.element.tagName,\n            }),\n            message: get('editing.error.nameClash', {\n              parent:\n                create.new.parent instanceof HTMLElement\n                  ? create.new.parent.tagName\n                  : 'Document',\n              child: create.new.element.tagName,\n              name: create.new.element.getAttribute('name')!,\n            }),\n          })\n        );\n\n        return false;\n      }\n\n      const invalidId =\n        create.new.element.hasAttribute('id') &&\n        Array.from(\n          create.new.parent.ownerDocument.querySelectorAll(\n            'LNodeType, DOType, DAType, EnumType'\n          )\n        ).some(\n          elm =>\n            elm.getAttribute('id') ===\n            (<Element>create.new.element).getAttribute('id')\n        );\n\n      if (invalidId) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.create', {\n              name: create.new.element.tagName,\n            }),\n            message: get('editing.error.idClash', {\n              id: create.new.element.getAttribute('id')!,\n            }),\n          })\n        );\n\n        return false;\n      }\n\n      return true;\n    }\n\n    private onCreate(action: Create) {\n      if (!this.checkCreateValidity(action)) return false;\n\n      if (\n        action.new.reference === undefined &&\n        action.new.element instanceof Element &&\n        action.new.parent instanceof Element\n      )\n        action.new.reference = getReference(\n          action.new.parent,\n          <SCLTag>action.new.element.tagName\n        );\n      else action.new.reference = action.new.reference ?? null;\n\n      action.new.parent.insertBefore(action.new.element, action.new.reference);\n      return true;\n    }\n\n    private logCreate(action: Create) {\n      const name =\n        action.new.element instanceof Element\n          ? action.new.element.tagName\n          : get('editing.node');\n\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'action',\n          title: get('editing.created', { name }),\n          action,\n        })\n      );\n    }\n\n    private onDelete(action: Delete) {\n      if (!action.old.reference)\n        action.old.reference = action.old.element.nextSibling;\n\n      if (action.old.element.parentNode !== action.old.parent) return false;\n\n      action.old.parent.removeChild(action.old.element);\n      return true;\n    }\n\n    private logDelete(action: Delete) {\n      const name =\n        action.old.element instanceof Element\n          ? action.old.element.tagName\n          : get('editing.node');\n\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'action',\n          title: get('editing.deleted', { name }),\n          action,\n        })\n      );\n    }\n\n    private checkMoveValidity(move: Move): boolean {\n      if (move.checkValidity !== undefined) return move.checkValidity();\n\n      const invalid =\n        move.old.element.hasAttribute('name') &&\n        move.new.parent !== move.old.parent &&\n        Array.from(move.new.parent.children).some(\n          elm =>\n            elm.tagName === move.old.element.tagName &&\n            elm.getAttribute('name') === move.old.element.getAttribute('name')\n        );\n\n      if (invalid)\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.move', {\n              name: move.old.element.tagName,\n            }),\n            message: get('editing.error.nameClash', {\n              parent: move.new.parent.tagName,\n              child: move.old.element.tagName,\n              name: move.old.element.getAttribute('name')!,\n            }),\n          })\n        );\n\n      return !invalid;\n    }\n\n    private onMove(action: Move) {\n      if (!this.checkMoveValidity(action)) return false;\n\n      if (!action.old.reference)\n        action.old.reference = action.old.element.nextSibling;\n\n      if (action.new.reference === undefined)\n        action.new.reference = getReference(\n          action.new.parent,\n          <SCLTag>action.old.element.tagName\n        );\n\n      action.new.parent.insertBefore(action.old.element, action.new.reference);\n      return true;\n    }\n\n    private logMove(action: Move) {\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'action',\n          title: get('editing.moved', {\n            name: action.old.element.tagName,\n          }),\n          action: action,\n        })\n      );\n    }\n\n    private checkReplaceValidity(replace: Replace): boolean {\n      if (replace.checkValidity !== undefined) return replace.checkValidity();\n\n      const invalidNaming =\n        replace.new.element.hasAttribute('name') &&\n        replace.new.element.getAttribute('name') !==\n          replace.old.element.getAttribute('name') &&\n        Array.from(replace.old.element.parentElement?.children ?? []).some(\n          elm =>\n            elm.tagName === replace.new.element.tagName &&\n            elm.getAttribute('name') ===\n              replace.new.element.getAttribute('name')\n        );\n\n      if (invalidNaming) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.update', {\n              name: replace.new.element.tagName,\n            }),\n            message: get('editing.error.nameClash', {\n              parent: replace.old.element.parentElement!.tagName,\n              child: replace.new.element.tagName,\n              name: replace.new.element.getAttribute('name')!,\n            }),\n          })\n        );\n\n        return false;\n      }\n\n      const invalidId =\n        replace.new.element.hasAttribute('id') &&\n        replace.new.element.getAttribute('id') !==\n          replace.old.element.getAttribute('id') &&\n        Array.from(\n          replace.new.element.ownerDocument.querySelectorAll(\n            'LNodeType, DOType, DAType, EnumType'\n          )\n        ).some(\n          elm =>\n            elm.getAttribute('id') ===\n            (<Element>replace.new.element).getAttribute('id')\n        );\n\n      if (invalidId) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.update', {\n              name: replace.new.element.tagName,\n            }),\n            message: get('editing.error.idClash', {\n              id: replace.new.element.getAttribute('id')!,\n            }),\n          })\n        );\n\n        return false;\n      }\n\n      return true;\n    }\n\n    private onReplace(action: Replace) {\n      if (!this.checkReplaceValidity(action)) return false;\n\n      action.new.element.append(...Array.from(action.old.element.children));\n      action.old.element.replaceWith(action.new.element);\n      return true;\n    }\n\n    private logUpdate(action: Replace | Update) {\n      const name = isReplace(action)\n        ? action.new.element.tagName\n        : (action as Update).element.tagName;\n\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'action',\n          title: get('editing.updated', {\n            name,\n          }),\n          action: action,\n        })\n      );\n    }\n\n    private checkUpdateValidity(update: Update): boolean {\n      if (update.checkValidity !== undefined) return update.checkValidity();\n\n      if (update.oldAttributes['name'] !== update.newAttributes['name']) {\n        const invalidNaming = Array.from(\n          update.element.parentElement?.children ?? []\n        ).some(\n          elm =>\n            elm.tagName === update.element.tagName &&\n            elm.getAttribute('name') === update.newAttributes['name']\n        );\n\n        if (invalidNaming) {\n          this.dispatchEvent(\n            newLogEvent({\n              kind: 'error',\n              title: get('editing.error.update', {\n                name: update.element.tagName,\n              }),\n              message: get('editing.error.nameClash', {\n                parent: update.element.parentElement!.tagName,\n                child: update.element.tagName,\n                name: update.newAttributes['name']!,\n              }),\n            })\n          );\n\n          return false;\n        }\n      }\n\n      const invalidId =\n        update.newAttributes['id'] &&\n        Array.from(\n          update.element.ownerDocument.querySelectorAll(\n            'LNodeType, DOType, DAType, EnumType'\n          )\n        ).some(elm => elm.getAttribute('id') === update.newAttributes['id']);\n\n      if (invalidId) {\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'error',\n            title: get('editing.error.update', {\n              name: update.element.tagName,\n            }),\n            message: get('editing.error.idClash', {\n              id: update.newAttributes['id']!,\n            }),\n          })\n        );\n\n        return false;\n      }\n\n      return true;\n    }\n\n    private onUpdate(action: Update) {\n      if (!this.checkUpdateValidity(action)) return false;\n\n      Array.from(action.element.attributes).forEach(attr =>\n        action.element.removeAttributeNode(attr)\n      );\n\n      Object.entries(action.newAttributes).forEach(([key, value]) => {\n        if (value !== null && value !== undefined)\n          action.element.setAttribute(key, value);\n      });\n\n      return true;\n    }\n\n    private onSimpleAction(action: SimpleAction) {\n      if (isMove(action)) return this.onMove(action as Move);\n      else if (isCreate(action)) return this.onCreate(action as Create);\n      else if (isDelete(action)) return this.onDelete(action as Delete);\n      else if (isReplace(action)) return this.onReplace(action as Replace);\n      else if (isUpdate(action)) return this.onUpdate(action as Update);\n    }\n\n    private logSimpleAction(action: SimpleAction) {\n      if (isMove(action)) this.logMove(action as Move);\n      else if (isCreate(action)) this.logCreate(action as Create);\n      else if (isDelete(action)) this.logDelete(action as Delete);\n      else if (isReplace(action)) this.logUpdate(action as Replace);\n      else if (isUpdate(action)) this.logUpdate(action as Update);\n    }\n\n    private async onAction(event: EditorActionEvent<EditorAction>) {\n      if (isSimple(event.detail.action)) {\n        if (this.onSimpleAction(event.detail.action))\n          this.logSimpleAction(event.detail.action);\n      } else if (event.detail.action.actions.length > 0) {\n        event.detail.action.actions.forEach(element =>\n          this.onSimpleAction(element)\n        );\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'action',\n            title: event.detail.action.title,\n            action: event.detail.action,\n          })\n        );\n      } else return;\n\n      if (!this.doc) return;\n\n      await this.updateComplete;\n      this.dispatchEvent(newValidateEvent());\n    }\n\n    /**\n     *\n     * @deprecated [Move to handleOpenDoc instead]\n     */\n    private async onOpenDoc(event: OpenDocEvent) {\n      this.doc = event.detail.doc;\n      this.docName = event.detail.docName;\n      this.docId = event.detail.docId ?? '';\n\n      await this.updateComplete;\n\n      this.dispatchEvent(newValidateEvent());\n\n      this.dispatchEvent(\n        newLogEvent({\n          kind: 'info',\n          title: get('openSCD.loaded', { name: this.docName }),\n        })\n      );\n    }\n\n    handleOpenDoc({ detail: { docName, doc } }: OpenEvent) {\n      this.doc = doc;\n      this.docName = docName;\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n\n      this.addEventListener('editor-action', this.onAction);\n      this.addEventListener('open-doc', this.onOpenDoc);\n      this.addEventListener('oscd-open', this.handleOpenDoc);\n    }\n  }\n\n  return EditingElement;\n}\n"]}