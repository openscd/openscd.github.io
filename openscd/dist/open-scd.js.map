{"version":3,"file":"open-scd.js","sourceRoot":"","sources":["../src/open-scd.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  LitElement,\n  property,\n  state,\n  TemplateResult,\n} from 'lit-element';\nimport { classMap } from 'lit-html/directives/class-map';\n\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-linear-progress';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-tab';\nimport '@material/mwc-tab-bar';\nimport '@material/mwc-top-app-bar-fixed';\nimport '@material/mwc-drawer';\nimport '@material/mwc-button';\nimport '@material/mwc-dialog';\nimport '@material/mwc-formfield';\nimport '@material/mwc-list/mwc-check-list-item';\nimport '@material/mwc-list/mwc-radio-list-item';\nimport '@material/mwc-select';\nimport '@material/mwc-switch';\nimport '@material/mwc-textfield';\n\nimport { newOpenDocEvent } from '@openscd/core/foundation/deprecated/open-event.js';\nimport { newPendingStateEvent } from '@openscd/core/foundation/deprecated/waiter.js';\n\nimport './addons/Settings.js';\nimport './addons/Waiter.js';\nimport './addons/Wizards.js';\nimport './addons/Editor.js';\nimport './addons/History.js';\nimport './addons/Layout.js';\n\nimport { ActionDetail } from '@material/mwc-list';\n\nimport { officialPlugins } from './plugins.js';\nimport { initializeNsdoc, Nsdoc } from './foundation/nsdoc.js';\nimport type {\n  PluginSet,\n  Plugin as CorePlugin,\n  EditCompletedEvent,\n} from '@openscd/core';\n\n// HOSTING INTERFACES\n\nexport interface MenuItem {\n  icon: string;\n  name: string;\n  hint?: string;\n  actionItem?: boolean;\n  action?: (event: CustomEvent<ActionDetail>) => void;\n  disabled?: () => boolean;\n  content?: TemplateResult;\n  kind: string;\n}\n\nexport interface Validator {\n  validate: () => Promise<void>;\n}\n\nexport interface MenuPlugin {\n  run: () => Promise<void>;\n}\n\nexport function newResetPluginsEvent(): CustomEvent {\n  return new CustomEvent('reset-plugins', { bubbles: true, composed: true });\n}\n\nexport interface AddExternalPluginDetail {\n  plugin: Omit<Plugin, 'content'>;\n}\n\nexport type AddExternalPluginEvent = CustomEvent<AddExternalPluginDetail>;\n\nexport function newAddExternalPluginEvent(\n  plugin: Omit<Plugin, 'content'>\n): AddExternalPluginEvent {\n  return new CustomEvent<AddExternalPluginDetail>('add-external-plugin', {\n    bubbles: true,\n    composed: true,\n    detail: { plugin },\n  });\n}\n\nexport interface SetPluginsDetail {\n  indices: Set<number>;\n}\n\nexport type SetPluginsEvent = CustomEvent<SetPluginsDetail>;\n\nexport function newSetPluginsEvent(indices: Set<number>): SetPluginsEvent {\n  return new CustomEvent<SetPluginsDetail>('set-plugins', {\n    bubbles: true,\n    composed: true,\n    detail: { indices },\n  });\n}\n\n// PLUGGING INTERFACES\nconst pluginTags = new Map<string, string>();\n/**\n * Hashes `uri` using cyrb64 analogous to\n * https://github.com/bryc/code/blob/master/jshash/experimental/cyrb53.js .\n * @returns a valid customElement tagName containing the URI hash.\n */\nfunction pluginTag(uri: string): string {\n  if (!pluginTags.has(uri)) {\n    let h1 = 0xdeadbeef,\n      h2 = 0x41c6ce57;\n    for (let i = 0, ch; i < uri.length; i++) {\n      ch = uri.charCodeAt(i);\n      h1 = Math.imul(h1 ^ ch, 2654435761);\n      h2 = Math.imul(h2 ^ ch, 1597334677);\n    }\n    h1 =\n      Math.imul(h1 ^ (h1 >>> 16), 2246822507) ^\n      Math.imul(h2 ^ (h2 >>> 13), 3266489909);\n    h2 =\n      Math.imul(h2 ^ (h2 >>> 16), 2246822507) ^\n      Math.imul(h1 ^ (h1 >>> 13), 3266489909);\n    pluginTags.set(\n      uri,\n      'oscd-plugin' +\n        ((h2 >>> 0).toString(16).padStart(8, '0') +\n          (h1 >>> 0).toString(16).padStart(8, '0'))\n    );\n  }\n  return pluginTags.get(uri)!;\n}\n\n/**\n * This is a template literal tag function. See:\n * https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Template_literals#tagged_templates\n *\n * Passes its arguments to LitElement's `html` tag after combining the first and\n * last expressions with the first two and last two static strings.\n * Throws unless the first and last expressions are identical strings.\n *\n * We need this to get around the expression location limitations documented in\n * https://lit.dev/docs/templates/expressions/#expression-locations\n *\n * After upgrading to Lit 2 we can use their static HTML functions instead:\n * https://lit.dev/docs/api/static-html/\n */\nfunction staticTagHtml(\n  oldStrings: ReadonlyArray<string>,\n  ...oldArgs: unknown[]\n): TemplateResult {\n  const args = [...oldArgs];\n  const firstArg = args.shift();\n  const lastArg = args.pop();\n\n  if (firstArg !== lastArg)\n    throw new Error(\n      `Opening tag <${firstArg}> does not match closing tag </${lastArg}>.`\n    );\n\n  const strings = [...oldStrings] as string[] & { raw: string[] };\n  const firstString = strings.shift();\n  const secondString = strings.shift();\n\n  const lastString = strings.pop();\n  const penultimateString = strings.pop();\n\n  strings.unshift(`${firstString}${firstArg}${secondString}`);\n  strings.push(`${penultimateString}${lastArg}${lastString}`);\n\n  return html(<TemplateStringsArray>strings, ...args);\n}\n\nexport type PluginKind = 'editor' | 'menu' | 'validator';\nexport const menuPosition = ['top', 'middle', 'bottom'] as const;\nexport type MenuPosition = (typeof menuPosition)[number];\n\nexport type Plugin = {\n  name: string;\n  src: string;\n  icon?: string;\n  default?: boolean;\n  kind: PluginKind;\n  requireDoc?: boolean;\n  position?: MenuPosition;\n  installed: boolean;\n  official?: boolean;\n  content?: TemplateResult;\n};\n\ntype InstalledOfficialPlugin = {\n  src: string;\n  official: true;\n  installed: boolean;\n};\n\nfunction withoutContent<P extends Plugin | InstalledOfficialPlugin>(\n  plugin: P\n): P {\n  return { ...plugin, content: undefined };\n}\n\nexport const pluginIcons: Record<PluginKind | MenuPosition, string> = {\n  editor: 'tab',\n  menu: 'play_circle',\n  validator: 'rule_folder',\n  top: 'play_circle',\n  middle: 'play_circle',\n  bottom: 'play_circle',\n};\n\nconst menuOrder: (PluginKind | MenuPosition)[] = [\n  'editor',\n  'top',\n  'validator',\n  'middle',\n  'bottom',\n];\n\nfunction menuCompare(a: Plugin, b: Plugin): -1 | 0 | 1 {\n  if (a.kind === b.kind && a.position === b.position) return 0;\n  const earlier = menuOrder.find(kind =>\n    [a.kind, b.kind, a.position, b.position].includes(kind)\n  );\n  return [a.kind, a.position].includes(earlier) ? -1 : 1;\n}\n\nfunction compareNeedsDoc(a: Plugin, b: Plugin): -1 | 0 | 1 {\n  if (a.requireDoc === b.requireDoc) return 0;\n  return a.requireDoc ? 1 : -1;\n}\n\nconst loadedPlugins = new Set<string>();\n\n/** The `<open-scd>` custom element is the main entry point of the\n * Open Substation Configuration Designer. */\n@customElement('open-scd')\nexport class OpenSCD extends LitElement {\n  @property({ attribute: false })\n  doc: XMLDocument | null = null;\n  /** The name of the current [[`doc`]] */\n  @property({ type: String }) docName = '';\n  /** The UUID of the current [[`doc`]] */\n  @property({ type: String }) docId = '';\n\n  /** Index of the last [[`EditorAction`]] applied. */\n  @state()\n  editCount = -1;\n\n  /** Object containing all *.nsdoc files and a function extracting element's label form them*/\n  @property({ attribute: false })\n  nsdoc: Nsdoc = initializeNsdoc();\n\n  private currentSrc = '';\n  /** The current file's URL. `blob:` URLs are *revoked after parsing*! */\n  @property({ type: String })\n  get src(): string {\n    return this.currentSrc;\n  }\n\n  set src(value: string) {\n    this.currentSrc = value;\n    this.dispatchEvent(newPendingStateEvent(this.loadDoc(value)));\n  }\n\n  /** Loads and parses an `XMLDocument` after [[`src`]] has changed. */\n  private async loadDoc(src: string): Promise<void> {\n    const response = await fetch(src);\n    const text = await response.text();\n    if (!text) return;\n\n    const doc = new DOMParser().parseFromString(text, 'application/xml');\n    const docName = src;\n    this.dispatchEvent(newOpenDocEvent(doc, docName));\n\n    if (src.startsWith('blob:')) URL.revokeObjectURL(src);\n  }\n\n  connectedCallback(): void {\n    super.connectedCallback();\n    this.addEventListener('reset-plugins', this.resetPlugins);\n    this.addEventListener(\n      'add-external-plugin',\n      (e: AddExternalPluginEvent) => {\n        this.addExternalPlugin(e.detail.plugin);\n      }\n    );\n    this.addEventListener('set-plugins', (e: SetPluginsEvent) => {\n      this.setPlugins(e.detail.indices);\n    });\n\n    this.updatePlugins();\n    this.requestUpdate();\n\n    this.addEventListener('oscd-edit-completed', (evt: EditCompletedEvent) => {\n      const initiator = evt.detail.initiator;\n\n      if (initiator === 'undo') {\n        this.editCount -= 1;\n      } else {\n        this.editCount += 1;\n      }\n\n      this.requestUpdate();\n    });\n  }\n\n  render(): TemplateResult {\n    return html`<oscd-waiter>\n      <oscd-settings .host=${this}>\n        <oscd-wizards .host=${this}>\n          <oscd-history .host=${this} .editCount=${this.editCount}>\n            <oscd-editor\n              .doc=${this.doc}\n              .docName=${this.docName}\n              .docId=${this.docId}\n              .host=${this}\n              .editCount=${this.editCount}\n            >\n              <oscd-layout\n                .host=${this}\n                .doc=${this.doc}\n                .docName=${this.docName}\n                .editCount=${this.editCount}\n                .plugins=${this.sortedStoredPlugins}\n              >\n              </oscd-layout>\n            </oscd-editor>\n          </oscd-history>\n        </oscd-wizards>\n      </oscd-settings>\n    </oscd-waiter>`;\n  }\n\n  private storePlugins(plugins: Array<Plugin | InstalledOfficialPlugin>) {\n    localStorage.setItem(\n      'plugins',\n      JSON.stringify(plugins.map(withoutContent))\n    );\n    this.requestUpdate();\n  }\n  private resetPlugins(): void {\n    this.storePlugins(\n      (officialPlugins as Plugin[]).concat(this.parsedPlugins).map(plugin => {\n        return {\n          src: plugin.src,\n          installed: plugin.default ?? false,\n          official: true,\n        };\n      })\n    );\n  }\n\n  /**\n   * @prop {PluginSet} plugins - Set of plugins that are used by OpenSCD\n   */\n  @property({ type: Object })\n  plugins: PluginSet = { menu: [], editor: [] };\n\n  get parsedPlugins(): Plugin[] {\n    return this.plugins.menu\n      .map((p: CorePlugin) => ({\n        ...p,\n        position:\n          typeof p.position !== 'number'\n            ? (p.position as MenuPosition)\n            : undefined,\n        kind: 'menu' as PluginKind,\n        installed: p.active ?? false,\n      }))\n      .concat(\n        this.plugins.editor.map((p: CorePlugin) => ({\n          ...p,\n          position: undefined,\n          kind: 'editor' as PluginKind,\n          installed: p.active ?? false,\n        }))\n      );\n  }\n\n  private get sortedStoredPlugins(): Plugin[] {\n    return this.storedPlugins\n      .map(plugin => {\n        if (!plugin.official) return plugin;\n        const officialPlugin = (officialPlugins as Plugin[])\n          .concat(this.parsedPlugins)\n          .find(needle => needle.src === plugin.src);\n        return <Plugin>{\n          ...officialPlugin,\n          ...plugin,\n        };\n      })\n      .sort(compareNeedsDoc)\n      .sort(menuCompare);\n  }\n\n  private get storedPlugins(): Plugin[] {\n    return <Plugin[]>(\n      JSON.parse(localStorage.getItem('plugins') ?? '[]', (key, value) =>\n        value.src && value.installed ? this.addContent(value) : value\n      )\n    );\n  }\n\n  protected get locale(): string {\n    return navigator.language || 'en-US';\n  }\n\n  get docs(): Record<string, XMLDocument> {\n    const docs: Record<string, XMLDocument> = {};\n\n    if (this.doc) {\n      docs[this.docName] = this.doc;\n    }\n\n    return docs;\n  }\n\n  private setPlugins(indices: Set<number>) {\n    const newPlugins = this.sortedStoredPlugins.map((plugin, index) => {\n      return { ...plugin, installed: indices.has(index) };\n    });\n    this.storePlugins(newPlugins);\n  }\n\n  private updatePlugins() {\n    const stored: Plugin[] = this.storedPlugins;\n    const officialStored = stored.filter(p => p.official);\n    const newOfficial: Array<Plugin | InstalledOfficialPlugin> = (\n      officialPlugins as Plugin[]\n    )\n      .concat(this.parsedPlugins)\n      .filter(p => !officialStored.find(o => o.src === p.src))\n      .map(plugin => {\n        return {\n          src: plugin.src,\n          installed: plugin.default ?? false,\n          official: true as const,\n        };\n      });\n    const oldOfficial = officialStored.filter(\n      p =>\n        !(officialPlugins as Plugin[])\n          .concat(this.parsedPlugins)\n          .find(o => p.src === o.src)\n    );\n    const newPlugins: Array<Plugin | InstalledOfficialPlugin> = stored.filter(\n      p => !oldOfficial.find(o => p.src === o.src)\n    );\n    newOfficial.map(p => newPlugins.push(p));\n    this.storePlugins(newPlugins);\n  }\n\n  private async addExternalPlugin(\n    plugin: Omit<Plugin, 'content'>\n  ): Promise<void> {\n    if (this.storedPlugins.some(p => p.src === plugin.src)) return;\n\n    const newPlugins: Omit<Plugin, 'content'>[] = this.storedPlugins;\n    newPlugins.push(plugin);\n    this.storePlugins(newPlugins);\n  }\n\n  private addContent(plugin: Omit<Plugin, 'content'>): Plugin {\n    const tag = pluginTag(plugin.src);\n    if (!loadedPlugins.has(tag)) {\n      loadedPlugins.add(tag);\n      import(plugin.src).then(mod => customElements.define(tag, mod.default));\n    }\n    return {\n      ...plugin,\n      content: staticTagHtml`<${tag}\n            .doc=${this.doc}\n            .docName=${this.docName}\n            .editCount=${this.editCount}\n            .docId=${this.docId}\n            .pluginId=${plugin.src}\n            .nsdoc=${this.nsdoc}\n            .docs=${this.docs}\n            .locale=${this.locale}\n            class=\"${classMap({\n              plugin: true,\n              menu: plugin.kind === 'menu',\n              validator: plugin.kind === 'validator',\n              editor: plugin.kind === 'editor',\n            })}\"\n          ></${tag}>`,\n    };\n  }\n}\n\ndeclare global {\n  interface ElementEventMap {\n    'reset-plugins': CustomEvent;\n    'add-external-plugin': CustomEvent<AddExternalPluginDetail>;\n    'set-plugins': CustomEvent<SetPluginsDetail>;\n  }\n}\n"]}