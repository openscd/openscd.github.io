{"version":3,"file":"enum-type-editor.js","sourceRoot":"","sources":["../../../../src/editors/templates/enum-type-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { repeat } from 'lit-html/directives/repeat.js';\nimport { translate, get } from 'lit-translate';\n\nimport { Select } from '@material/mwc-select';\n\nimport {\n  EditorAction,\n  getValue,\n  newActionEvent,\n  newWizardEvent,\n  patterns,\n  Wizard,\n  WizardActor,\n  WizardInput,\n} from '../../foundation.js';\n\nimport {\n  isCreateOptions,\n  styles,\n  updateIDNamingAction,\n  WizardOptions,\n} from './foundation.js';\nimport './enum-val-editor.js';\nimport { EnumValEditor } from './enum-val-editor.js';\n\n/** [[`Templates`]] plugin subeditor for editing `EnumType` sections. */\n@customElement('enum-type-editor')\nexport class EnumTypeEditor extends LitElement {\n  @property()\n  element!: Element;\n\n  /** [[element | `element.id`]] */\n  @property({ type: String })\n  get eID(): string {\n    return this.element.getAttribute('id') ?? '';\n  }\n  /** [[element | `element.desc`]] */\n  @property({ type: String })\n  get desc(): string | null {\n    return this.element.getAttribute('desc');\n  }\n  /** Number of enum values. */\n  @property({ type: Number })\n  get size(): number {\n    return this.element.querySelectorAll('EnumVal').length;\n  }\n\n  /** Opens a [[`WizardDialog`]] for editing [[`element`]]. */\n  openEditWizard(): void {\n    this.dispatchEvent(\n      newWizardEvent(EnumTypeEditor.wizard({ element: this.element }))\n    );\n  }\n\n  render(): TemplateResult {\n    return html`<mwc-list-item\n      @click=${() => this.openEditWizard()}\n      graphic=\"icon\"\n      hasMeta\n      tabindex=\"0\"\n    >\n      <span>${this.eID}</span>\n      <mwc-icon slot=\"meta\">edit</mwc-icon>\n      <span slot=\"graphic\">${this.size}</span>\n    </mwc-list-item>`;\n  }\n\n  static createAction(parent: Element, templates: XMLDocument): WizardActor {\n    return (inputs: WizardInput[]): EditorAction[] => {\n      const id = getValue(inputs.find(i => i.label === 'id')!);\n\n      if (!id) return [];\n\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n      const values = <Select>inputs.find(i => i.label === 'values');\n      const element = values.selected\n        ? <Element>(\n            templates\n              .querySelector(`EnumType[id=\"${values.selected.value}\"]`)!\n              .cloneNode(true)\n          )\n        : parent.ownerDocument.createElement('EnumType');\n\n      element.setAttribute('id', id);\n      if (desc) element.setAttribute('desc', desc);\n\n      const action = {\n        new: {\n          parent,\n          element,\n          reference: parent.firstElementChild,\n        },\n      };\n\n      return [action];\n    };\n  }\n\n  private static createWizard(parent: Element, templates: Document): Wizard {\n    return [\n      {\n        title: get('enum.wizard.title.add'),\n        primary: {\n          icon: 'add',\n          label: get('add'),\n          action: EnumTypeEditor.createAction(parent, templates),\n        },\n        content: [\n          html`<mwc-select\n            style=\"--mdc-menu-max-height: 196px;\"\n            outlined\n            icon=\"playlist_add_check\"\n            label=\"values\"\n            helper=\"Default enumerations\"\n          >\n            ${Array.from(templates.querySelectorAll('EnumType')).map(\n              e =>\n                html`<mwc-list-item\n                  graphic=\"icon\"\n                  hasMeta\n                  value=\"${e.getAttribute('id') ?? ''}\"\n                  ><span>${e.getAttribute('id')}</span>\n                  <span slot=\"meta\"\n                    >${e.querySelectorAll('EnumVal').length}</span\n                  >\n                </mwc-list-item>`\n            )}\n          </mwc-select>`,\n          html`<wizard-textfield\n            label=\"id\"\n            helper=\"${translate('scl.id')}\"\n            .maybeValue=${''}\n            required\n            maxlength=\"127\"\n            minlength=\"1\"\n            pattern=\"${patterns.nmToken}\"\n            dialogInitialFocus\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            label=\"desc\"\n            helper=\"${translate('scl.desc')}\"\n            .maybeValue=${null}\n            nullable\n            pattern=\"${patterns.normalizedString}\"\n          ></wizard-textfield>`,\n        ],\n      },\n    ];\n  }\n\n  private static editWizard(element: Element): Wizard {\n    return [\n      {\n        title: get('enum.wizard.title.edit'),\n        primary: {\n          icon: 'edit',\n          label: get('save'),\n          action: updateIDNamingAction(element),\n        },\n        content: [\n          html`<mwc-button\n            icon=\"delete\"\n            trailingIcon\n            label=\"${translate('delete')}\"\n            @click=${(e: MouseEvent) => {\n              e.target!.dispatchEvent(newWizardEvent());\n              e.target!.dispatchEvent(\n                newActionEvent({\n                  old: {\n                    parent: element.parentElement!,\n                    element: element,\n                    reference: element.nextElementSibling,\n                  },\n                })\n              );\n            }}\n            fullwidth\n          ></mwc-button> `,\n          html`<wizard-textfield\n            label=\"id\"\n            helper=\"${translate('scl.id')}\"\n            .maybeValue=${element.getAttribute('id')}\n            required\n            maxlength=\"127\"\n            minlength=\"1\"\n            pattern=\"${patterns.nmToken}\"\n            dialogInitialFocus\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            label=\"desc\"\n            helper=\"${translate('scl.desc')}\"\n            .maybeValue=${element.getAttribute('desc')}\n            nullable\n            pattern=\"${patterns.normalizedString}\"\n          ></wizard-textfield>`,\n          html`<mwc-button\n              slot=\"graphic\"\n              icon=\"playlist_add\"\n              trailingIcon\n              label=\"${translate('scl.EnumVal')}\"\n              @click=${(e: MouseEvent) =>\n                e.target!.dispatchEvent(\n                  newWizardEvent(EnumValEditor.wizard({ parent: element }), {\n                    detail: { subwizard: true },\n                  })\n                )}\n            ></mwc-button>\n            <mwc-list style=\"margin-top: 0px;\">\n              ${repeat(\n                // FIXME(c-dinkel): broken lib.dom.iterable.d.ts hack\n                <Iterable<ChildNode>>(<unknown>element.childNodes),\n                child =>\n                  child instanceof Element\n                    ? html`<enum-val-editor\n                        .element=${child}\n                      ></enum-val-editor>`\n                    : html``\n              )}\n            </mwc-list> `,\n        ],\n      },\n    ];\n  }\n\n  static wizard(options: WizardOptions): Wizard {\n    return isCreateOptions(options)\n      ? EnumTypeEditor.createWizard(options.parent, options.templates)\n      : EnumTypeEditor.editWizard(options.element);\n  }\n\n  static styles = styles;\n}\n"]}