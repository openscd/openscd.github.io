{"version":3,"file":"enum-val-editor.js","sourceRoot":"","sources":["../../../../src/editors/templates/enum-val-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { translate, get } from 'lit-translate';\n\nimport {\n  createElement,\n  EditorAction,\n  getReference,\n  getValue,\n  newActionEvent,\n  newWizardEvent,\n  patterns,\n  Wizard,\n  WizardActor,\n  WizardInput,\n} from '../../foundation.js';\nimport {\n  isCreateOptions,\n  styles,\n  WizardOptions,\n} from '../substation/foundation.js';\n\nfunction nextOrd(parent: Element): string {\n  const maxOrd = Math.max(\n    ...Array.from(parent.children).map(child =>\n      parseInt(child.getAttribute('ord') ?? '-2', 10)\n    )\n  );\n  return isFinite(maxOrd) ? (maxOrd + 1).toString(10) : '0';\n}\n\n/** [[`Templates`]] plugin subeditor for editing `EnumVal`s. */\n@customElement('enum-val-editor')\nexport class EnumValEditor extends LitElement {\n  @property()\n  element!: Element;\n\n  /** [[element | `element.ord`]] */\n  @property({ type: Number })\n  get ord(): string {\n    return this.element.getAttribute('ord') ?? '-1';\n  }\n  /** [[element | `element.desc`]] */\n  @property({ type: String })\n  get desc(): string | null {\n    return this.element.getAttribute('desc');\n  }\n  /** [[element | `element.textContent` ]] */\n  @property({ type: String })\n  get value(): string {\n    return this.element.textContent ?? '';\n  }\n\n  /** Opens a [[`WizardDialog`]] for editing [[`element`]]. */\n  openEditWizard(): void {\n    this.dispatchEvent(\n      newWizardEvent(EnumValEditor.wizard({ element: this.element }), {\n        detail: { subwizard: true },\n      })\n    );\n  }\n\n  render(): TemplateResult {\n    return html`<mwc-list-item\n      @click=${() => this.openEditWizard()}\n      graphic=\"icon\"\n      hasMeta\n      tabindex=\"0\"\n    >\n      <span>${this.value}</span>\n      <span slot=\"graphic\">${this.ord}</span>\n      <mwc-icon slot=\"meta\">edit</mwc-icon>\n    </mwc-list-item>`;\n  }\n\n  static createAction(parent: Element): WizardActor {\n    return (inputs: WizardInput[]): EditorAction[] => {\n      const value = getValue(inputs.find(i => i.label === 'value')!);\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n      const ord =\n        getValue(inputs.find(i => i.label === 'ord')!) || nextOrd(parent);\n\n      const element = createElement(parent.ownerDocument, 'EnumVal', {\n        ord,\n        desc,\n      });\n\n      element.textContent = value;\n\n      const action = {\n        new: {\n          parent,\n          element,\n          reference: getReference(parent, 'EnumVal'),\n        },\n      };\n\n      return [action];\n    };\n  }\n\n  static updateAction(element: Element): WizardActor {\n    return (inputs: WizardInput[]): EditorAction[] => {\n      const value = getValue(inputs.find(i => i.label === 'value')!) ?? '';\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n      const ord =\n        getValue(inputs.find(i => i.label === 'ord')!) ||\n        element.getAttribute('ord') ||\n        nextOrd(element.parentElement!);\n\n      if (\n        value === element.textContent &&\n        desc === element.getAttribute('desc') &&\n        ord === element.getAttribute('ord')\n      )\n        return [];\n\n      const newElement = <Element>element.cloneNode(false);\n      if (desc === null) newElement.removeAttribute('desc');\n      else newElement.setAttribute('desc', desc);\n      newElement.setAttribute('ord', ord);\n      newElement.textContent = value;\n\n      return [{ old: { element }, new: { element: newElement } }];\n    };\n  }\n\n  static wizard(options: WizardOptions): Wizard {\n    const [\n      heading,\n      actionName,\n      actionIcon,\n      action,\n      ord,\n      desc,\n      value,\n    ] = isCreateOptions(options)\n      ? [\n          get('enum-val.wizard.title.add'),\n          get('add'),\n          'add',\n          EnumValEditor.createAction(options.parent),\n          nextOrd(options.parent),\n          null, // desc is uncommon on EnumVal\n          '',\n        ]\n      : [\n          get('enum-val.wizard.title.edit'),\n          get('save'),\n          'edit',\n          EnumValEditor.updateAction(options.element),\n          options.element.getAttribute('ord'),\n          options.element.getAttribute('desc'),\n          options.element.textContent,\n        ];\n\n    return [\n      {\n        title: heading,\n        primary: {\n          icon: actionIcon,\n          label: actionName,\n          action: action,\n        },\n        content: [\n          isCreateOptions(options)\n            ? html``\n            : html`<mwc-button\n                icon=\"delete\"\n                trailingIcon\n                label=${translate('delete')}\n                @click=${(e: MouseEvent) => {\n                  e.target!.dispatchEvent(newWizardEvent());\n                  e.target!.dispatchEvent(\n                    newActionEvent({\n                      old: {\n                        parent: options.element.parentElement!,\n                        element: options.element,\n                        reference: options.element.nextElementSibling,\n                      },\n                    })\n                  );\n                }}\n                fullwidth\n              ></mwc-button>`,\n          html`<wizard-textfield\n            label=\"ord\"\n            helper=\"${translate('scl.ord')}\"\n            .maybeValue=${ord}\n            required\n            type=\"number\"\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            label=\"value\"\n            helper=\"${translate('scl.value')}\"\n            .maybeValue=${value}\n            pattern=\"${patterns.normalizedString}\"\n            dialogInitialFocus\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            id=\"evDesc\"\n            label=\"desc\"\n            helper=\"${translate('scl.desc')}\"\n            .maybeValue=${desc}\n            nullable\n            pattern=\"${patterns.normalizedString}\"\n          ></wizard-textfield>`,\n        ],\n      },\n    ];\n  }\n\n  static styles = css`\n    ${styles}\n\n    section {\n      overflow: auto;\n    }\n\n    :host {\n      width: 100vw;\n    }\n  `;\n}\n"]}