{"version":3,"file":"conducting-equipment-editor.js","sourceRoot":"","sources":["../../../../src/editors/substation/conducting-equipment-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\nimport { translate, get } from 'lit-translate';\n\nimport {\n  createElement,\n  EditorAction,\n  getReference,\n  getValue,\n  newActionEvent,\n  newWizardEvent,\n  Wizard,\n  WizardActor,\n  WizardInput,\n} from '../../foundation.js';\n\nimport {\n  isCreateOptions,\n  selectors,\n  startMove,\n  updateNamingAction,\n  WizardOptions,\n} from './foundation.js';\nimport { typeIcon, typeName, types } from './conducting-equipment-types.js';\nimport { editlNode } from './lnodewizard.js';\nimport { BayEditor } from './bay-editor.js';\n\n/** [[`SubstationEditor`]] subeditor for a `ConductingEquipment` element. */\n@customElement('conducting-equipment-editor')\nexport class ConductingEquipmentEditor extends LitElement {\n  @property({ type: Element })\n  element!: Element;\n\n  @property({ type: String })\n  get name(): string {\n    return this.element.getAttribute('name') ?? '';\n  }\n  @property({ type: String })\n  get desc(): string {\n    return this.element.getAttribute('desc') ?? '';\n  }\n\n  openEditWizard(): void {\n    this.dispatchEvent(\n      newWizardEvent(\n        ConductingEquipmentEditor.wizard({ element: this.element })\n      )\n    );\n  }\n\n  openLNodeWizard(): void {\n    this.dispatchEvent(newWizardEvent(editlNode(this.element)));\n  }\n\n  remove(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement!,\n            element: this.element,\n            reference: this.element.nextElementSibling,\n          },\n        })\n      );\n  }\n\n  render(): TemplateResult {\n    return html`\n      <div id=\"container\" tabindex=\"0\">\n        ${typeIcon(this.element)}\n        <mwc-fab\n          mini\n          class=\"menu-item left\"\n          @click=\"${() => this.openLNodeWizard()}\"\n          icon=\"account_tree\"\n        ></mwc-fab>\n        <mwc-fab\n          mini\n          class=\"menu-item up\"\n          icon=\"edit\"\n          @click=\"${() => this.openEditWizard()}}\"\n        ></mwc-fab>\n        <mwc-fab\n          mini\n          class=\"menu-item right\"\n          @click=\"${() =>\n            startMove(this, ConductingEquipmentEditor, BayEditor)}\"\n          icon=\"forward\"\n        ></mwc-fab>\n        <mwc-fab\n          mini\n          class=\"menu-item down\"\n          icon=\"delete\"\n          @click=\"${() => this.remove()}}\"\n        ></mwc-fab>\n      </div>\n      <h4>${this.name}</h4>\n    `;\n  }\n\n  static createAction(parent: Element): WizardActor {\n    return (inputs: WizardInput[]): EditorAction[] => {\n      const name = getValue(inputs.find(i => i.label === 'name')!);\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n      const proxyType = getValue(inputs.find(i => i.label === 'type')!);\n      const type = proxyType === 'ERS' ? 'DIS' : proxyType;\n\n      const element = createElement(\n        parent.ownerDocument,\n        'ConductingEquipment',\n        { name, type, desc }\n      );\n\n      if (proxyType === 'ERS')\n        element.appendChild(\n          createElement(parent.ownerDocument, 'Terminal', {\n            name: 'T1',\n            cNodeName: 'grounded',\n          })\n        );\n\n      const action = {\n        new: {\n          parent,\n          element,\n          reference: getReference(parent, 'ConductingEquipment'),\n        },\n      };\n\n      return [action];\n    };\n  }\n\n  static wizard(options: WizardOptions): Wizard {\n    const [\n      heading,\n      actionName,\n      actionIcon,\n      action,\n      name,\n      desc,\n      reservedNames,\n    ] = isCreateOptions(options)\n      ? [\n          get('conductingequipment.wizard.title.add'),\n          get('add'),\n          'add',\n          ConductingEquipmentEditor.createAction(options.parent),\n          '',\n          '',\n          Array.from(\n            options.parent.querySelectorAll(selectors.ConductingEquipment)\n          ).map(condEq => condEq.getAttribute('name') ?? ''),\n        ]\n      : [\n          get('conductingequipment.wizard.title.edit'),\n          get('save'),\n          'edit',\n          updateNamingAction(options.element),\n          options.element.getAttribute('name'),\n          options.element.getAttribute('desc'),\n          Array.from(\n            options.element.parentNode!.querySelectorAll(\n              selectors.ConductingEquipment\n            )\n          )\n            .map(condEq => condEq.getAttribute('name') ?? '')\n            .filter(name => name !== options.element.getAttribute('name')),\n        ];\n\n    return [\n      {\n        title: heading,\n        primary: {\n          icon: actionIcon,\n          label: actionName,\n          action: action,\n        },\n        content: [\n          ConductingEquipmentEditor.renderTypeSelector(options),\n          html`<wizard-textfield\n            label=\"name\"\n            .maybeValue=${name}\n            helper=\"${translate('conductingequipment.wizard.nameHelper')}\"\n            required\n            validationMessage=\"${translate('textfield.required')}\"\n            dialogInitialFocus\n            .reservedValues=${reservedNames}\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            label=\"desc\"\n            .maybeValue=${desc}\n            nullable\n            helper=\"${translate('conductingequipment.wizard.descHelper')}\"\n          ></wizard-textfield>`,\n        ],\n      },\n    ];\n  }\n\n  static renderTypeSelector(options: WizardOptions): TemplateResult {\n    return isCreateOptions(options)\n      ? html`<mwc-select\n          style=\"--mdc-menu-max-height: 196px;\"\n          required\n          label=\"type\"\n          helper=\"${translate('conductingequipment.wizard.typeHelper')}\"\n          validationMessage=\"${translate('textfield.required')}\"\n        >\n          ${Object.keys(types).map(\n            v => html`<mwc-list-item value=\"${v}\">${types[v]}</mwc-list-item>`\n          )}\n        </mwc-select>`\n      : html`<mwc-select\n          label=\"type\"\n          helper=\"${translate('conductingequipment.wizard.typeHelper')}\"\n          validationMessage=\"${translate('textfield.required')}\"\n          disabled\n        >\n          <mwc-list-item selected value=\"0\"\n            >${typeName(options.element)}</mwc-list-item\n          >\n        </mwc-select>`;\n  }\n\n  static styles = css`\n    #container {\n      color: var(--mdc-theme-on-surface);\n      width: 64px;\n      height: 64px;\n      margin: auto;\n      position: relative;\n      transition: all 200ms linear;\n    }\n\n    #container:focus {\n      outline: none;\n    }\n\n    #container > svg {\n      color: var(--mdc-theme-on-surface);\n      width: 64px;\n      height: 64px;\n      transition: transform 150ms linear, box-shadow 200ms linear;\n      outline-color: var(--mdc-theme-primary);\n      outline-style: solid;\n      outline-width: 0px;\n    }\n\n    #container:focus > svg {\n      box-shadow: 0 8px 10px 1px rgba(0, 0, 0, 0.14),\n        0 3px 14px 2px rgba(0, 0, 0, 0.12), 0 5px 5px -3px rgba(0, 0, 0, 0.2);\n    }\n\n    #container:hover > svg {\n      outline: 2px dashed var(--mdc-theme-primary);\n      transition: transform 200ms linear, box-shadow 250ms linear;\n    }\n\n    #container:focus-within > svg {\n      outline: 2px solid var(--mdc-theme-primary);\n      background: var(--mdc-theme-on-primary);\n      transform: scale(0.8);\n      transition: transform 200ms linear, box-shadow 250ms linear;\n    }\n\n    .menu-item {\n      color: var(--mdc-theme-on-surface);\n      transition: transform 200ms cubic-bezier(0.4, 0, 0.2, 1),\n        opacity 200ms linear;\n      position: absolute;\n      top: 8px;\n      left: 8px;\n      pointer-events: none;\n      z-index: 1;\n      opacity: 0;\n    }\n\n    #container:focus-within > .menu-item {\n      transition: transform 250ms cubic-bezier(0.4, 0, 0.2, 1),\n        opacity 250ms linear;\n      pointer-events: auto;\n      opacity: 1;\n    }\n\n    #container:focus-within > .menu-item.up {\n      transform: translate(0px, -52px);\n    }\n\n    #container:focus-within > .menu-item.down {\n      transform: translate(0px, 52px);\n    }\n\n    #container:focus-within > .menu-item.right {\n      transform: translate(52px, 0px);\n    }\n\n    #container:focus-within > .menu-item.left {\n      transform: translate(-52px, 0px);\n    }\n\n    h4 {\n      color: var(--mdc-theme-on-surface);\n      font-family: 'Roboto', sans-serif;\n      font-weight: 300;\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      margin: 0px;\n      opacity: 1;\n      transition: opacity 200ms linear;\n      text-align: center;\n    }\n\n    :host(.moving) #container,\n    :host(.moving) h4 {\n      opacity: 0.3;\n    }\n  `;\n}\n"]}