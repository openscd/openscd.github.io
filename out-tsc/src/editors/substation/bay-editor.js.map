{"version":3,"file":"bay-editor.js","sourceRoot":"","sources":["../../../../src/editors/substation/bay-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  LitElement,\n  TemplateResult,\n  html,\n  property,\n  css,\n  query,\n} from 'lit-element';\nimport {\n  Wizard,\n  WizardAction,\n  WizardInput,\n  CloseableElement,\n  EditorAction,\n  newWizardEvent,\n  newActionEvent,\n  getValue,\n} from '../../foundation.js';\nimport { get, translate } from 'lit-translate';\n\nimport './conducting-equipment-editor.js';\nimport { ConductingEquipmentEditor } from './conducting-equipment-editor.js';\n\ninterface BayUpdateOptions {\n  element: Element;\n}\ninterface BayCreateOptions {\n  parent: Element;\n}\ntype BayWizardOptions = BayUpdateOptions | BayCreateOptions;\nfunction isBayCreateOptions(\n  options: BayWizardOptions\n): options is BayCreateOptions {\n  return (<BayCreateOptions>options).parent !== undefined;\n}\n\n@customElement('bay-editor')\nexport class BayEditor extends LitElement {\n  @property({ type: Element })\n  element!: Element;\n\n  @property({ type: Element })\n  parent!: Element;\n\n  @property({ type: String })\n  get name(): string {\n    return this.element.getAttribute('name') ?? '';\n  }\n\n  @property({ type: String })\n  get desc(): string | null {\n    return this.element.getAttribute('desc') ?? null;\n  }\n\n  @query('h3') header!: Element;\n\n  openEditWizard(): void {\n    this.dispatchEvent(\n      newWizardEvent(BayEditor.wizard({ element: this.element }))\n    );\n  }\n\n  openConductingEquipmentWizard(): void {\n    if (!this.element) return;\n    const event = newWizardEvent(\n      ConductingEquipmentEditor.wizard({ parent: this.element })\n    );\n    this.dispatchEvent(event);\n  }\n\n  removeAction(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: { parent: this.parent, element: this.element, reference: null },\n        })\n      );\n  }\n\n  renderHeader(): TemplateResult {\n    return html`<div id=\"header\">\n      <h3>\n        ${this.name} ${this.desc === null ? '' : html`&mdash;`} ${this.desc}\n      </h3>\n      <div id=\"header-icon\">\n        <mwc-icon-button\n          icon=\"edit\"\n          @click=${() => this.openEditWizard()}\n        ></mwc-icon-button>\n        <mwc-icon-button\n          icon=\"delete\"\n          @click=${() => this.removeAction()}\n        ></mwc-icon-button>\n        <span style=\"position:relative; float:right;\">&#124;</span>\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => this.openConductingEquipmentWizard()}\n        ></mwc-icon-button>\n      </div>\n    </div> `;\n  }\n\n  render(): TemplateResult {\n    return html`<div id=\"container\">\n      ${this.renderHeader()}\n      ${Array.from(\n        this.element?.querySelectorAll('ConductingEquipment') ?? []\n      ).map(\n        voltageLevel =>\n          html`<conducting-equipment-editor\n            .element=${voltageLevel}\n            .parent=${this.element}\n          ></conducting-equipment-editor>`\n      )}\n    </div> `;\n  }\n\n  static createAction(parent: Element): WizardAction {\n    return (\n      inputs: WizardInput[],\n      wizard: CloseableElement\n    ): EditorAction[] => {\n      const name = getValue(inputs.find(i => i.label === 'name')!);\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n\n      const action = {\n        new: {\n          parent,\n          element: new DOMParser().parseFromString(\n            `<Bay\n              name=\"${name}\"\n              ${desc === null ? '' : `desc=\"${desc}\"`}\n            ></Bay>`,\n            'application/xml'\n          ).documentElement,\n          reference: null,\n        },\n      };\n\n      wizard.close();\n      return [action];\n    };\n  }\n\n  static updateAction(element: Element): WizardAction {\n    return (\n      inputs: WizardInput[],\n      wizard: CloseableElement\n    ): EditorAction[] => {\n      const name = inputs.find(i => i.label === 'name')!.value;\n      const desc = getValue(inputs.find(i => i.label === 'desc')!);\n\n      let bayAction: EditorAction | null;\n\n      if (\n        name === element.getAttribute('name') &&\n        desc === element.getAttribute('desc')\n      ) {\n        bayAction = null;\n      } else {\n        const newElement = <Element>element.cloneNode(false);\n        newElement.setAttribute('name', name);\n        if (desc === null) newElement.removeAttribute('desc');\n        else newElement.setAttribute('desc', desc);\n        bayAction = { old: { element }, new: { element: newElement } };\n      }\n\n      if (bayAction) wizard.close();\n      const actions: EditorAction[] = [];\n      if (bayAction) actions.push(bayAction);\n      return actions;\n    };\n  }\n\n  static wizard(options: BayWizardOptions): Wizard {\n    const [heading, actionName, actionIcon, action] = isBayCreateOptions(\n      options\n    )\n      ? [\n          get('bay.wizard.title.add'),\n          get('add'),\n          'add',\n          BayEditor.createAction(options.parent),\n        ]\n      : [\n          get('bay.wizard.title.edit'),\n          get('save'),\n          'edit',\n          BayEditor.updateAction(options.element),\n        ];\n    const [name, desc] = isBayCreateOptions(options)\n      ? ['', null]\n      : [\n          options.element.getAttribute('name'),\n          options.element.getAttribute('desc'),\n        ];\n    return [\n      {\n        title: heading,\n        primary: {\n          icon: actionIcon,\n          label: actionName,\n          action: action,\n        },\n        content: [\n          html`<wizard-textfield\n            label=\"name\"\n            .maybeValue=${name}\n            helper=\"${translate('bay.wizard.nameHelper')}\"\n            iconTrailing=\"title\"\n            required\n            validationMessage=\"${translate('textfield.required')}\"\n            dialogInitialFocus\n          ></wizard-textfield>`,\n          html`<wizard-textfield\n            label=\"desc\"\n            .maybeValue=${desc}\n            nullable=\"true\"\n            helper=\"${translate('bay.wizard.descHelper')}\"\n            iconTrailing=\"description\"\n          ></wizard-textfield>`,\n        ],\n      },\n    ];\n  }\n\n  static styles = css`\n    #container {\n      width: 320px;\n      min-height: 320px;\n      background-color: var(--mdc-theme-surface);\n      margin: 10px;\n    }\n\n    #header {\n      display: flex;\n      color: var(--mdc-theme-on-surface);\n    }\n\n    h3 {\n      font-family: 'Roboto', sans-serif;\n      font-weight: 300;\n      overflow: hidden;\n      white-space: nowrap;\n      text-overflow: ellipsis;\n      flex: auto;\n      padding-left: 0.5em;\n    }\n\n    #header-icon {\n      display: flex;\n      align-items: center;\n    }\n\n    #header > mwc-icon-button {\n      position: relative;\n      float: right;\n      top: -5px;\n    }\n  `;\n}\n"]}