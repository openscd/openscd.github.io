{"version":3,"file":"Waiting.js","sourceRoot":"","sources":["../../src/Waiting.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAkB,MAAM,aAAa,CAAC;AAE7D,OAAO,EAIL,aAAa,GAEd,MAAM,iBAAiB,CAAC;AAMzB,MAAM,UAAU,OAAO,CAAsC,IAAW;IACtE,MAAM,cAAe,SAAQ,IAAI;QAkB/B,YAAY,GAAG,IAAW;YACxB,KAAK,CAAC,GAAG,IAAI,CAAC,CAAC;YAlBjB,oEAAoE;YAEpE,YAAO,GAAG,KAAK,CAAC;YAER,SAAI,GAAuB,IAAI,GAAG,EAAE,CAAC;YAC7C,wEAAwE;YACxE,aAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAcvC,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACrD,IAAI,CAAC,gBAAgB,CAAC,eAAe,EAAE,IAAI,CAAC,cAAc,CAAC,CAAC;QAC9D,CAAC;QAdO,KAAK,CAAC,cAAc,CAAC,CAAkC;YAC7D,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YACpB,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YAChC,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YAC9C,MAAM,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC;YAC7D,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,CAAC;YACnC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC,IAAI,GAAG,CAAC,CAAC;QACpC,CAAC;QASD,MAAM;YACJ,OAAO,IAAI,CAAA,GAAG,aAAa,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC;;oBAE7B,CAAC,IAAI,CAAC,OAAO;;6CAEY,CAAC;QAC1C,CAAC;KACF;IA7BC;QADC,QAAQ,CAAC,EAAE,IAAI,EAAE,OAAO,EAAE,CAAC;mDACZ;IA+BlB,OAAO,cAAc,CAAC;AACxB,CAAC","sourcesContent":["import { html, property, TemplateResult } from 'lit-element';\n\nimport {\n  LitElementConstructor,\n  Mixin,\n  PendingStateDetail,\n  ifImplemented,\n  newLogEvent,\n} from './foundation.js';\n\n/** Mixin implementing\n * [Pending State](https://github.com/justinfagnani/pending-state-protocol) */\nexport type WaitingElement = Mixin<typeof Waiting>;\n\nexport function Waiting<TBase extends LitElementConstructor>(Base: TBase) {\n  class WaitingElement extends Base {\n    /** Whether the element is currently waiting for some async work. */\n    @property({ type: Boolean })\n    waiting = false;\n\n    private work: Set<Promise<void>> = new Set();\n    /** A promise which resolves once all currently pending work is done. */\n    workDone = Promise.allSettled(this.work);\n\n    private async onPendingState(e: CustomEvent<PendingStateDetail>) {\n      this.waiting = true;\n      this.work.add(e.detail.promise);\n      this.workDone = Promise.allSettled(this.work);\n      await e.detail.promise.catch(reason => console.warn(reason));\n      this.work.delete(e.detail.promise);\n      this.waiting = this.work.size > 0;\n    }\n\n    constructor(...args: any[]) {\n      super(...args);\n\n      this.onPendingState = this.onPendingState.bind(this);\n      this.addEventListener('pending-state', this.onPendingState);\n    }\n\n    render(): TemplateResult {\n      return html`${ifImplemented(super.render())}\n        <mwc-circular-progress-four-color\n          .closed=${!this.waiting}\n          indeterminate\n        ></mwc-circular-progress-four-color>`;\n    }\n  }\n\n  return WaitingElement;\n}\n"]}