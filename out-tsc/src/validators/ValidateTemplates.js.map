{"version":3,"file":"ValidateTemplates.js","sourceRoot":"","sources":["../../../src/validators/ValidateTemplates.ts"],"names":[],"mappings":"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","sourcesContent":["import { LitElement, property } from 'lit-element';\nimport { get } from 'lit-translate';\nimport {\n  identity,\n  LogDetail,\n  LogDetailBase,\n  newIssueEvent,\n  newLogEvent,\n} from '../foundation.js';\n\ntype ValidationResult = LogDetailBase | LogDetail;\n\nconst iec6185074 = fetch('public/xml/IEC_61850-7-4_2007B3.nsd')\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nconst iec6185073 = fetch('public/xml/IEC_61850-7-3_2007B3.nsd')\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nconst iec6185072 = fetch('public/xml/IEC_61850-7-2_2007B3.nsd')\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nconst iec6185081 = fetch('public/xml/IEC_61850-8-1_2003A2.nsd')\n  .then(response => response.text())\n  .then(str => new DOMParser().parseFromString(str, 'application/xml'));\n\nconst serviceCDCs = ['SPC', 'DPC', 'INC', 'ENC', 'BSC', 'ISC', 'APC', 'BAC'];\n\nfunction dispatch(\n  detail: ValidationResult,\n  statusNumber: number,\n  validatorId: string\n): void {\n  const title = (<LogDetailBase>detail).title;\n  const message = (<LogDetailBase>detail).message;\n  document.querySelector('open-scd')?.dispatchEvent(\n    newIssueEvent({\n      validatorId,\n      statusNumber: statusNumber,\n      title,\n      message,\n    })\n  );\n}\n\nasync function validateCoOperStructure(\n  oper: Element\n): Promise<ValidationResult[]> {\n  const type = oper.getAttribute('type');\n  if (!type) return [];\n\n  const datype =\n    oper.closest('DataTypeTemplates')?.querySelector(`DAType[id=\"${type}\"]`) ??\n    null;\n\n  const nsd81 = await iec6185081;\n\n  const errors: ValidationResult[] = [];\n  const mandatoryBDAs = Array.from(\n    nsd81.querySelectorAll(\n      `ServiceConstructedAttributes > ServiceConstructedAttribute[name=\"Oper\"] > SubDataAttribute[presCond=\"M\"]`\n    )\n  ).map(data => data.getAttribute('name')!);\n\n  for (const mandatoryBDA of mandatoryBDAs)\n    if (datype && !datype.querySelector(`BDA[name=\"${mandatoryBDA}\"]`))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'DAType',\n          id: type,\n          childTag: 'BDA',\n          childId: mandatoryBDA,\n        }),\n        message: `${identity(datype)}`,\n      });\n\n  return errors;\n}\n\nasync function validateCoSBOwStructure(\n  sbow: Element\n): Promise<ValidationResult[]> {\n  const type = sbow.getAttribute('type');\n  if (!type) return [];\n\n  const datype =\n    sbow.closest('DataTypeTemplates')?.querySelector(`DAType[id=\"${type}\"]`) ??\n    null;\n\n  const nsd81 = await iec6185081;\n\n  const errors: ValidationResult[] = [];\n  const mandatoryBDAs = Array.from(\n    nsd81.querySelectorAll(\n      `ServiceConstructedAttributes > ServiceConstructedAttribute[name=\"SBOw\"] > SubDataAttribute[presCond=\"M\"]`\n    )\n  ).map(data => data.getAttribute('name')!);\n\n  for (const mandatoryBDA of mandatoryBDAs)\n    if (datype && !datype.querySelector(`BDA[name=\"${mandatoryBDA}\"]`))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'SBOw',\n          id: type,\n          childTag: 'BDA',\n          childId: mandatoryBDA,\n        }),\n        message: `${identity(datype)}`,\n      });\n\n  return errors;\n}\n\nasync function validateCoCancelStructure(\n  cancel: Element\n): Promise<ValidationResult[]> {\n  const type = cancel.getAttribute('type');\n  if (!type) return [];\n\n  const datype =\n    cancel\n      .closest('DataTypeTemplates')\n      ?.querySelector(`DAType[id=\"${type}\"]`) ?? null;\n\n  const nsd81 = await iec6185081;\n\n  const errors: ValidationResult[] = [];\n  const mandatoryBDAs = Array.from(\n    nsd81.querySelectorAll(\n      `ServiceConstructedAttributes > ServiceConstructedAttribute[name=\"Cancel\"] > SubDataAttribute[presCond=\"M\"]`\n    )\n  ).map(data => data.getAttribute('name')!);\n\n  for (const mandatoryBDA of mandatoryBDAs)\n    if (datype && !datype.querySelector(`BDA[name=\"${mandatoryBDA}\"]`))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'DAType',\n          id: type,\n          childTag: 'BDA',\n          childId: mandatoryBDA,\n        }),\n        message: `${identity(datype)}`,\n      });\n\n  return errors;\n}\n\nfunction missingCoDataToLog(\n  reference: string | number,\n  type: 'Oper' | 'SBOw' | 'SBO' | 'Cancel'\n): ValidationResult {\n  return {\n    title: get('validator.templates.missingCoDO', { type }),\n    message: `${reference}`,\n  };\n}\n\nexport async function validateControlCDC(\n  dotype: Element\n): Promise<ValidationResult[]> {\n  //characteristic for controlable CDCs is the third and last character that must be xxC\n  if (\n    dotype.getAttribute('cdc') &&\n    !serviceCDCs.includes(dotype.getAttribute('cdc')!)\n  )\n    return [];\n\n  let errors: ValidationResult[] = [];\n  const ctlModel = dotype\n    .querySelector('DA[name=\"ctlModel\"] > Val')\n    ?.textContent?.trim();\n  const oper = dotype.querySelector('DA[fc=\"CO\"][name=\"Oper\"][bType=\"Struct\"]');\n  const sbo = dotype.querySelector('DA[fc=\"CO\"][name=\"SBO\"][bType=\"ObjRef\"]');\n  const cancel = dotype.querySelector(\n    'DA[fc=\"CO\"][name=\"Cancel\"][bType=\"Struct\"]'\n  );\n  const sbow = dotype.querySelector('DA[fc=\"CO\"][name=\"SBOw\"][bType=\"Struct\"]');\n\n  if (ctlModel === 'sbo-with-enhanced-security') {\n    const errorsSBOw = sbow\n      ? await validateCoSBOwStructure(sbow)\n      : [missingCoDataToLog(identity(dotype), 'SBOw')];\n    const errorsCancel = cancel\n      ? await validateCoCancelStructure(cancel)\n      : [missingCoDataToLog(identity(dotype), 'Cancel')];\n    errors = errorsSBOw.concat(errorsCancel);\n  } else if (ctlModel === 'sbo-with-normal-security') {\n    errors = cancel\n      ? await validateCoCancelStructure(cancel)\n      : [missingCoDataToLog(identity(dotype), 'Cancel')];\n    if (!sbo) errors.push(missingCoDataToLog(identity(dotype), 'SBO'));\n  } else if (\n    ctlModel === 'direct-with-normal-security' ||\n    ctlModel === 'direct-with-enhanced-security'\n  ) {\n    errors = oper\n      ? await validateCoOperStructure(oper)\n      : [missingCoDataToLog(identity(dotype), 'Oper')];\n  } else if (ctlModel !== 'status-only') {\n    return [\n      {\n        title: get('validator.templates.missingCtlModelDef', {\n          tag: 'DOType',\n          id: dotype.id || 'UNIDENTIFIABLE',\n          childTag: 'ctlModel',\n          childId: 'Val',\n        }),\n        message: <string>(identity(dotype) || 'UNIDENTIFIABLE'),\n      },\n    ];\n  }\n\n  return errors;\n}\n\nasync function getMandatorySubDAs(datype: Element): Promise<Element[]> {\n  const parentDAs =\n    Array.from(\n      datype\n        .closest('DataTypeTemplates')!\n        .querySelectorAll<Element>(\n          `DOType > DA[type=\"${datype.getAttribute('id')}\"]`\n        )\n    ) ?? [];\n\n  const nsd = await iec6185073;\n  const dataAttributes = parentDAs.map(parentDA => {\n    const parentCDC = <Element>parentDA.parentElement!;\n    return nsd.querySelector(\n      `CDC[name=\"${parentCDC.getAttribute(\n        'cdc'\n      )}\"] > DataAttribute[name=\"${parentDA.getAttribute('name')}\"]`\n    );\n  });\n\n  const type = dataAttributes\n    .filter(data => data && data.getAttribute('typeKind') === 'CONSTRUCTED')\n    .map(data => data?.getAttribute('type') ?? '')\n    .filter(type => type !== '');\n\n  return (\n    Array.from(\n      nsd.querySelectorAll(\n        `ConstructedAttributes > ConstructedAttribute[name=\"${type[0]}\"] > SubDataAttribute[presCond=\"M\"]`\n      )\n    ) ?? []\n  );\n}\n\nexport async function validateMandatorySubDAs(\n  datype: Element\n): Promise<ValidationResult[]> {\n  const mandatorySubDAs = await getMandatorySubDAs(datype);\n  const subDANames = mandatorySubDAs.map(\n    DA => DA.getAttribute('name') ?? 'NONAME'\n  );\n  const missingDANames = subDANames.filter(\n    da => !datype.querySelector(`BDA[name=\"${da}\"]`)\n  );\n\n  return missingDANames.map(da => {\n    return {\n      title: get('validator.templates.mandatoryChild', {\n        tag: 'DAType',\n        id: datype.getAttribute('id') ?? '',\n        childTag: 'DA',\n        childId: da,\n      }),\n      message: `${datype}`,\n    };\n  });\n}\n\nasync function getMandatoryDataAttribute(base: string): Promise<Element[]> {\n  const nsd = await iec6185073;\n  const cdc = nsd.querySelector(`CDC[name=\"${base}\"]`);\n\n  if (!cdc) return [];\n\n  return Array.from(cdc.querySelectorAll('DataAttribute[presCond=\"M\"]'));\n}\n\nexport async function validateMandatoryDAs(\n  dotype: Element\n): Promise<ValidationResult[]> {\n  const errors: ValidationResult[] = [];\n  const cdc = dotype.getAttribute('cdc');\n  if (!cdc) return [];\n\n  const mandatorydas = (await getMandatoryDataAttribute(cdc)).map(\n    DA => DA.getAttribute('name')!\n  );\n\n  mandatorydas.forEach(mandatoryda => {\n    if (!dotype.querySelector(`DA[name=\"${mandatoryda}\"]`))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'Common Data Class',\n          id: cdc,\n          childTag: 'DA',\n          childId: mandatoryda,\n        }),\n        message: `${identity(dotype)}`,\n      });\n  });\n\n  return errors;\n}\n\nfunction getAdjacentClass(nsd: XMLDocument, base: string): Element[] {\n  if (base === '') return [];\n  const adjacents = getAdjacentClass(\n    nsd,\n    nsd\n      .querySelector(`LNClass[name=\"${base}\"], AbstractLNClass[name=\"${base}\"]`)\n      ?.getAttribute('base') ?? ''\n  );\n  return Array.from(\n    nsd.querySelectorAll(\n      `LNClass[name=\"${base}\"], AbstractLNClass[name=\"${base}\"]`\n    )\n  ).concat(adjacents);\n}\n\nasync function getAllDataObjects(base: string): Promise<Element[]> {\n  const lnodeclasses = getAdjacentClass(await iec6185074, base);\n\n  return lnodeclasses.flatMap(lnodeclass =>\n    Array.from(lnodeclass.querySelectorAll('DataObject'))\n  );\n}\n\nexport async function validateDoCDCSetting(\n  lnodetype: Element\n): Promise<ValidationResult[]> {\n  const errors: ValidationResult[] = [];\n  const lnClass = lnodetype.getAttribute('lnClass');\n  if (!lnClass) return [];\n\n  const alldos = await getAllDataObjects(lnClass);\n\n  for (const DO of alldos) {\n    const type = lnodetype\n      .querySelector(`DO[name=\"${DO.getAttribute('name')}\"]`)\n      ?.getAttribute('type');\n\n    if (!type) continue;\n\n    const dOType = lnodetype\n      .closest('DataTypeTemplates')\n      ?.querySelector(`DOType[id=\"${type}\"]`);\n\n    if (!dOType) {\n      errors.push({\n        title: get('validator.templates.cannotValidate', {\n          tag: 'LNodeType',\n          id: lnClass,\n          childTag: 'DO',\n          childId: DO.getAttribute('name') || 'UNNAMED',\n        }),\n        message: `${identity(lnodetype)}`,\n      });\n      continue;\n    }\n\n    if (dOType!.getAttribute('cdc') !== DO.getAttribute('type'))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'DOType',\n          id: dOType.getAttribute('cdc') || 'UNCLASSIFIED',\n          childTag: 'DO',\n          childId: DO.getAttribute('type') || 'UNTYPED',\n        }),\n        message: `${identity(dOType)} > ${DO.getAttribute('name')}`,\n      });\n  }\n\n  return errors;\n}\n\nasync function getMandatoryDataObject(base: string): Promise<Element[]> {\n  const lnodeclasses = getAdjacentClass(await iec6185074, base);\n\n  return lnodeclasses.flatMap(lnodeclass =>\n    Array.from(lnodeclass.querySelectorAll('DataObject[presCond=\"M\"]'))\n  );\n}\n\nexport async function validateMandatoryDOs(\n  lnodetype: Element\n): Promise<LogDetailBase[]> {\n  const errors: LogDetailBase[] = [];\n  const lnClass = lnodetype.getAttribute('lnClass');\n  if (!lnClass) return [];\n\n  const mandatorydos = await (\n    await getMandatoryDataObject(lnClass)\n  ).map(DO => DO.getAttribute('name')!);\n\n  mandatorydos.forEach(mandatorydo => {\n    if (!lnodetype.querySelector(`DO[name=\"${mandatorydo}\"]`))\n      errors.push({\n        title: get('validator.templates.mandatoryChild', {\n          tag: 'lnClass',\n          id: lnClass,\n          childTag: 'DO',\n          childId: mandatorydo,\n        }),\n        message: `${identity(lnodetype)} > ${mandatorydo}`,\n      });\n  });\n\n  return errors;\n}\n\nexport default class ValidateTemplates extends LitElement {\n  @property({ attribute: false })\n  doc!: XMLDocument;\n  @property()\n  docName!: string;\n\n  @property()\n  pluginId!: string;\n\n  async validate(identity: string, statusNumber: number): Promise<void> {\n    const promises: Promise<void>[] = [];\n    for (const lnodetype of Array.from(\n      this.doc.querySelectorAll('LNodeType')\n    )) {\n      promises.push(\n        validateMandatoryDOs(lnodetype).then(errors => {\n          errors.forEach(error => dispatch(error, statusNumber, this.pluginId));\n        })\n      );\n\n      promises.push(\n        validateDoCDCSetting(lnodetype).then(errors => {\n          errors.forEach(error => dispatch(error, statusNumber, this.pluginId));\n        })\n      );\n    }\n\n    for (const dotype of Array.from(this.doc.querySelectorAll('DOType'))) {\n      promises.push(\n        validateMandatoryDAs(dotype).then(errors => {\n          errors.forEach(error => dispatch(error, statusNumber, this.pluginId));\n        })\n      );\n      promises.push(\n        validateControlCDC(dotype).then(errors => {\n          errors.forEach(error => dispatch(error, statusNumber, this.pluginId));\n        })\n      );\n    }\n\n    for (const datype of Array.from(this.doc.querySelectorAll('DAType')))\n      promises.push(\n        validateMandatorySubDAs(datype).then(errors => {\n          errors.forEach(error => dispatch(error, statusNumber, this.pluginId));\n        })\n      );\n\n    await Promise.allSettled(promises);\n  }\n}\n"]}