{"version":3,"file":"bay-editor.js","sourceRoot":"","sources":["../../../src/zeroline/bay-editor.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { translate } from 'lit-translate';\n\nimport { startMove, styles, cloneSubstationElement } from './foundation.js';\nimport {\n  getChildElementsByTagName,\n  newActionEvent,\n  newWizardEvent,\n  SCLTag,\n  tags,\n} from '../foundation.js';\n\nimport { emptyWizard, wizards } from '../wizards/wizard-library.js';\n\nimport { VoltageLevelEditor } from './voltage-level-editor.js';\nimport './conducting-equipment-editor.js';\nimport '../action-pane.js';\nimport { Menu } from '@material/mwc-menu';\nimport { IconButton } from '@material/mwc-icon-button';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\n\nfunction childTags(element: Element | null | undefined): SCLTag[] {\n  if (!element) return [];\n\n  return tags[<SCLTag>element.tagName].children.filter(\n    child => wizards[child].create !== emptyWizard\n  );\n}\n\n/** [[`SubstationEditor`]] subeditor for a `Bay` element. */\n@customElement('bay-editor')\nexport class BayEditor extends LitElement {\n  @property({ attribute: false })\n  element!: Element;\n  @property({ type: Boolean })\n  readonly = false;\n\n  @property({ type: String })\n  get header(): string {\n    const name = this.element.getAttribute('name') ?? '';\n    const desc = this.element.getAttribute('desc');\n\n    return `${name} ${desc ? `- ${desc}` : ''}`;\n  }\n\n  @property({ attribute: false })\n  getAttachedIeds?: (element: Element) => Element[] = () => {\n    return [];\n  };\n\n  @query('mwc-menu') addMenu!: Menu;\n  @query('mwc-icon-button[icon=\"playlist_add\"]') addButton!: IconButton;\n\n  openEditWizard(): void {\n    const wizard = wizards['Bay'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  /** Opens a [[`WizardDialog`]] for editing `LNode` connections. */\n  openLNodeWizard(): void {\n    const wizard = wizards['LNode'].edit(this.element);\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  remove(): void {\n    if (this.element)\n      this.dispatchEvent(\n        newActionEvent({\n          old: {\n            parent: this.element.parentElement!,\n            element: this.element,\n            reference: this.element.nextSibling,\n          },\n        })\n      );\n  }\n\n  private openCreateWizard(tagName: string): void {\n    const wizard = wizards[<SCLTag>tagName].create(this.element!);\n\n    if (wizard) this.dispatchEvent(newWizardEvent(wizard));\n  }\n\n  firstUpdated(): void {\n    this.addMenu.anchor = <HTMLElement>this.addButton;\n  }\n\n  renderIedContainer(): TemplateResult {\n    const ieds = this.getAttachedIeds?.(this.element) ?? [];\n    return ieds?.length\n      ? html`<div id=\"iedcontainer\">\n          ${ieds.map(ied => html`<ied-editor .element=${ied}></ied-editor>`)}\n        </div>`\n      : html``;\n  }\n\n  private renderAddButtons(): TemplateResult[] {\n    return childTags(this.element).map(\n      child =>\n        html`<mwc-list-item value=\"${child}\"\n          ><span>${child}</span></mwc-list-item\n        >`\n    );\n  }\n\n  render(): TemplateResult {\n    return html`<action-pane label=\"${this.header}\">\n      <abbr slot=\"action\" title=\"${translate('lnode.tooltip')}\">\n        <mwc-icon-button\n          icon=\"account_tree\"\n          @click=\"${() => this.openLNodeWizard()}\"\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${translate('duplicate')}\">\n        <mwc-icon-button\n          icon=\"content_copy\"\n          @click=${() => cloneSubstationElement(this)}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${translate('edit')}\">\n        <mwc-icon-button\n          icon=\"edit\"\n          @click=${() => this.openEditWizard()}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${translate('move')}\">\n        <mwc-icon-button\n          icon=\"forward\"\n          @click=${() => startMove(this, BayEditor, VoltageLevelEditor)}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr slot=\"action\" title=\"${translate('remove')}\">\n        <mwc-icon-button\n          icon=\"delete\"\n          @click=${() => this.remove()}\n        ></mwc-icon-button>\n      </abbr>\n      <abbr\n        slot=\"action\"\n        style=\"position:relative;\"\n        title=\"${translate('add')}\"\n      >\n        <mwc-icon-button\n          icon=\"playlist_add\"\n          @click=${() => (this.addMenu.open = true)}\n        ></mwc-icon-button\n        ><mwc-menu\n          corner=\"BOTTOM_RIGHT\"\n          menuCorner=\"END\"\n          @selected=${(e: Event) => {\n            const tagName = (<ListItem>(<Menu>e.target).selected).value;\n            this.openCreateWizard(tagName);\n          }}\n          >${this.renderAddButtons()}</mwc-menu\n        >\n      </abbr>\n      ${this.renderIedContainer()}\n      <div id=\"ceContainer\">\n        ${Array.from(\n          getChildElementsByTagName(this.element, 'ConductingEquipment')\n        ).map(\n          voltageLevel =>\n            html`<conducting-equipment-editor\n              .element=${voltageLevel}\n              ?readonly=${this.readonly}\n            ></conducting-equipment-editor>`\n        )}\n      </div>\n    </action-pane> `;\n  }\n\n  static styles = css`\n    ${styles}\n\n    #ceContainer {\n      display: grid;\n      grid-gap: 12px;\n      padding: 12px;\n      box-sizing: border-box;\n      grid-template-columns: repeat(auto-fit, minmax(64px, auto));\n    }\n  `;\n}\n"]}