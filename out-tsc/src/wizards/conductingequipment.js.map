{"version":3,"file":"conductingequipment.js","sourceRoot":"","sources":["../../../src/wizards/conductingequipment.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, TemplateResult } from 'lit-element';\nimport { get, translate } from 'lit-translate';\n\nimport {\n  createElement,\n  EditorAction,\n  getReference,\n  getValue,\n  isPublic,\n  Wizard,\n  WizardActor,\n  WizardInput,\n} from '../foundation.js';\nimport { updateNamingAction } from './foundation/actions.js';\n\nconst types: Partial<Record<string, string>> = {\n  // standard\n  CBR: 'Circuit Breaker',\n  DIS: 'Disconnector',\n  // custom\n  ERS: 'Earth Switch',\n  CTR: 'Current Transformer',\n  VTR: 'Voltage Transformer',\n  AXN: 'Auxiliary Network',\n  BAT: 'Battery',\n  BSH: 'Bushing',\n  CAP: 'Capacitor Bank',\n  CON: 'Converter',\n  EFN: 'Earth Fault Neutralizer',\n  FAN: 'Fan',\n  GIL: 'Gas Insulated Line',\n  GEN: 'Generator',\n  IFL: 'Infeeding Line',\n  MOT: 'Motor',\n  RES: 'Neutral Resistor',\n  REA: 'Reactor',\n  PSH: 'Power Shunt',\n  CAB: 'Power Cable',\n  PMP: 'Pump',\n  LIN: 'Power Overhead Line',\n  RRC: 'Rotating Reactive Component',\n  SCR: 'Semiconductor Controlled Rectifier',\n  SAR: 'Surge Arrester',\n  SMC: 'Synchronous Machine',\n  TCF: 'Thyristor Controlled Frequency Converter',\n  TCR: 'Thyristor Controlled Reactive Component',\n};\n\nfunction typeStr(condEq: Element): string {\n  return condEq.getAttribute('type') === 'DIS' &&\n    condEq.querySelector('Terminal')?.getAttribute('cNodeName') === 'grounded'\n    ? 'ERS'\n    : condEq.getAttribute('type') ?? '';\n}\n\nfunction typeName(condEq: Element): string {\n  return types[typeStr(condEq)] ?? get('conductingequipment.unknownType');\n}\n\nfunction renderTypeSelector(\n  option: 'edit' | 'create',\n  type: string\n): TemplateResult {\n  return option === 'create'\n    ? html`<mwc-select\n        style=\"--mdc-menu-max-height: 196px;\"\n        required\n        label=\"type\"\n        helper=\"${translate('conductingequipment.wizard.typeHelper')}\"\n        validationMessage=\"${translate('textfield.required')}\"\n      >\n        ${Object.keys(types).map(\n          v => html`<mwc-list-item value=\"${v}\">${types[v]}</mwc-list-item>`\n        )}\n      </mwc-select>`\n    : html`<mwc-select\n        label=\"type\"\n        helper=\"${translate('conductingequipment.wizard.typeHelper')}\"\n        validationMessage=\"${translate('textfield.required')}\"\n        disabled\n      >\n        <mwc-list-item selected value=\"0\">${type}</mwc-list-item>\n      </mwc-select>`;\n}\n\nfunction render(\n  name: string | null,\n  desc: string | null,\n  option: 'edit' | 'create',\n  type: string,\n  reservedNames: string[]\n): TemplateResult[] {\n  return [\n    renderTypeSelector(option, type),\n    html`<wizard-textfield\n      label=\"name\"\n      .maybeValue=${name}\n      helper=\"${translate('conductingequipment.wizard.nameHelper')}\"\n      required\n      validationMessage=\"${translate('textfield.required')}\"\n      dialogInitialFocus\n      .reservedValues=${reservedNames}\n    ></wizard-textfield>`,\n    html`<wizard-textfield\n      label=\"desc\"\n      .maybeValue=${desc}\n      nullable\n      helper=\"${translate('conductingequipment.wizard.descHelper')}\"\n    ></wizard-textfield>`,\n  ];\n}\n\nexport function createAction(parent: Element): WizardActor {\n  return (inputs: WizardInput[]): EditorAction[] => {\n    const name = getValue(inputs.find(i => i.label === 'name')!);\n    const desc = getValue(inputs.find(i => i.label === 'desc')!);\n    const proxyType = getValue(inputs.find(i => i.label === 'type')!);\n    const type = proxyType === 'ERS' ? 'DIS' : proxyType;\n\n    const element = createElement(parent.ownerDocument, 'ConductingEquipment', {\n      name,\n      type,\n      desc,\n    });\n\n    if (proxyType === 'ERS')\n      element.appendChild(\n        createElement(parent.ownerDocument, 'Terminal', {\n          name: 'T1',\n          cNodeName: 'grounded',\n        })\n      );\n\n    const action = {\n      new: {\n        parent,\n        element,\n        reference: getReference(parent, 'ConductingEquipment'),\n      },\n    };\n\n    return [action];\n  };\n}\n\nexport function createConductingEquipmentWizard(parent: Element): Wizard {\n  const reservedNames = Array.from(\n    parent.querySelectorAll('ConductingEquipment')\n  )\n    .filter(isPublic)\n    .map(condEq => condEq.getAttribute('name') ?? '');\n\n  return [\n    {\n      title: get('conductingequipment.wizard.title.add'),\n      element: undefined,\n      primary: {\n        icon: 'add',\n        label: get('add'),\n        action: createAction(parent),\n      },\n      content: render('', '', 'create', '', reservedNames),\n    },\n  ];\n}\n\nexport function editConductingEquipmentWizard(element: Element): Wizard {\n  const reservedNames = Array.from(\n    element.parentNode!.querySelectorAll('ConductingEquipment')\n  )\n    .filter(isPublic)\n    .map(condEq => condEq.getAttribute('name') ?? '')\n    .filter(name => name !== element.getAttribute('name'));\n\n  return [\n    {\n      title: get('conductingequipment.wizard.title.edit'),\n      element,\n      primary: {\n        icon: 'edit',\n        label: get('save'),\n        action: updateNamingAction(element),\n      },\n      content: render(\n        element.getAttribute('name'),\n        element.getAttribute('desc'),\n        'edit',\n        typeName(element),\n        reservedNames\n      ),\n    },\n  ];\n}\n"]}