{"version":3,"file":"lnode.js","sourceRoot":"","sources":["../../../src/wizards/lnode.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,IAAI,EAAE,MAAM,EAAkB,MAAM,UAAU,CAAC;AACxD,OAAO,EAAE,GAAG,EAAE,SAAS,EAAE,MAAM,eAAe,CAAC;AAE/C,OAAO,EACL,aAAa,EAEb,yBAAyB,EACzB,QAAQ,EACR,QAAQ,EACR,aAAa,EACb,QAAQ,GAIT,MAAM,kBAAkB,CAAC;AAG1B,OAAO,EAAE,QAAQ,EAAE,MAAM,kCAAkC,CAAC;AAY5D,wEAAwE;AACxE,MAAM,WAAW,GAAsC;IACrD,GAAG,EAAE,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7B,GAAG,EAAE,CAAC,MAAM,EAAE,MAAM,EAAE,MAAM,CAAC;IAC7B,GAAG,EAAE,CAAC,MAAM,CAAC;IACb,GAAG,EAAE,CAAC,MAAM,CAAC;IACb,GAAG,EAAE,CAAC,MAAM,CAAC;IACb,YAAY,EAAE,CAAC,MAAM,CAAC;IACtB,UAAU,EAAE,CAAC,MAAM,CAAC;CACrB,CAAC;AAEF,6EAA6E;AAC7E,SAAS,OAAO,CAAC,CAAkB,EAAE,CAAkB;IACrD,IAAI,CAAC,CAAC,QAAQ,KAAK,CAAC,CAAC,QAAQ;QAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE1D,IAAI,CAAC,CAAC,SAAS,KAAK,CAAC,CAAC,SAAS;QAAE,OAAO,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE7D,IAAI,CAAC,CAAC,QAAQ,KAAK,CAAC,CAAC,QAAQ;QAAE,OAAO,CAAC,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;IAE1D,OAAO,CAAC,CAAC;AACX,CAAC;AAED,MAAM,QAAQ,GAAG,WAAW,CAAC;AAE7B,yEAAyE;AACzE,MAAM,UAAU,QAAQ,CACtB,MAA6B,EAC7B,KAAc;IAEd,OAAO,CACL,KAAK,CAAC,IAAI,CAAC,MAAM,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;SAC7C,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;SACxC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC,IAAI,IAAI,CAC9D,CAAC;AACJ,CAAC;AAED,SAAS,gBAAgB,CAAC,KAAc,EAAE,KAAc;IACtD,OAAO,CACL,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QACnC,CAAC,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QACpD,CAAC,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YAClC,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC;QACxD,CAAC,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;YAClC,CAAC,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QACtC,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;YACnC,CAAC,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC;QACvC,CAAC,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC,KAAK,CAAC,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE,CAAC,CAC5E,CAAC;AACJ,CAAC;AAED,SAAS,YAAY,CAAC,MAAe,EAAE,KAAc;IACnD,MAAM,OAAO,GAAG,aAAa,CAAC,MAAM,CAAC,aAAa,EAAE,OAAO,EAAE;QAC3D,OAAO,EAAE,KAAK,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE;QACzD,MAAM,EAAE,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE;QAC5D,MAAM,EAAE,KAAK,CAAC,YAAY,CAAC,QAAQ,CAAC,IAAI,EAAE;QAC1C,OAAO,EAAE,KAAK,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE;QAC5C,MAAM,EAAE,KAAK,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE;KACzC,CAAC,CAAC;IAEH,OAAO;QACL,GAAG,EAAE;YACH,MAAM;YACN,OAAO;SACR;KACF,CAAC;AACJ,CAAC;AAED,SAAS,YAAY,CAAC,MAAe,EAAE,KAAc;IACnD,OAAO;QACL,GAAG,EAAE;YACH,MAAM,EAAE,MAAM;YACd,OAAO,EAAE,KAAK;YACd,SAAS,EAAE,KAAK,CAAC,kBAAkB;SACpC;KACF,CAAC;AACJ,CAAC;AAED,SAAS,aAAa,CAAC,MAAiB,EAAE,KAAc;IACtD,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;AAC9D,CAAC;AAED,SAAS,aAAa,CAAC,KAAc,EAAE,MAAiB;IACtD,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,CAAC,gBAAgB,CAAC,KAAK,EAAE,KAAK,CAAC,CAAC,CAAC;AAC9D,CAAC;AAED;;;GAGG;AACH,MAAM,UAAU,iBAAiB,CAAC,MAAe;IAC/C,OAAO,CACL,MAAqB,EACrB,MAAe,EACf,IAAkB,EACF,EAAE;QAClB,MAAM,aAAa,GAAc,IAAK,CAAC,KAAK;aACzC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,QAAQ,CAAC;aAC7B,GAAG,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC;aACvB,GAAG,CAAC,QAAQ,CAAC,EAAE;YACd,OAAO,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;gBAClE,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;gBAC/D,CAAC,CAAC,MAAM,CAAC,aAAa,CAAC,aAAa,CAAC,QAAQ,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC,CAAC;QACnE,CAAC,CAAC;aACD,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK,IAAI,CAAC,CAAC;QAEjC,MAAM,SAAS,GAAG,yBAAyB,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC,MAAM,CACjE,QAAQ,CACT,CAAC;QAEF,MAAM,aAAa,GAAG,SAAS;aAC5B,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,aAAa,EAAE,KAAK,CAAC,CAAC;aACrD,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;QAC7C,MAAM,aAAa,GAAG,aAAa;aAChC,MAAM,CAAC,KAAK,CAAC,EAAE,CAAC,CAAC,aAAa,CAAC,KAAK,EAAE,SAAS,CAAC,CAAC;aACjD,GAAG,CAAC,KAAK,CAAC,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,CAAC,CAAC,CAAC;QAE7C,OAAO,aAAa,CAAC,MAAM,CAAC,aAAa,CAAC,CAAC;IAC7C,CAAC,CAAC;AACJ,CAAC;AAED,SAAS,gBAAgB,CAAC,MAAe,EAAE,QAAgB;IACzD,OAAO,CACL,MAAM,CAAC,aAAa,EAAE,aAAa,EAAE,kBAAkB,EAAE,aAAa,CACpE,QAAQ,CACT,IAAI,IAAI,CACV,CAAC;AACJ,CAAC;AAED,SAAS,WAAW,CAAC,GAAuB,EAAE,MAAe;IAC3D,IAAI,CAAC,CAAC,GAAG,CAAC,MAAM,YAAY,QAAQ,CAAC;QAAE,OAAO;IAC9C,MAAM,MAAM,GAAG,gBAAgB,CAAC,GAAG,CAAC,MAAM,EAAE,SAAS,CAAC,CAAC;IACvD,IAAI,MAAM,KAAK,IAAI;QAAE,OAAO;IAE5B,MAAM,GAAG,GAAG,MAAM,CAAC,aAAa,CAAC;IAEjC,MAAM,gBAAgB,GAAe,GAAG,CAAC,MAAM,CAAC,QAAQ,CAAC;IAEzD,MAAM,OAAO,GAAG,gBAAgB;SAC7B,OAAO,CAAC,IAAI,CAAC,EAAE,CACd,KAAK,CAAC,IAAI,CACR,GAAG,CAAC,gBAAgB,CAClB,qBAAqB,IAAI,CAAC,KAAK,wBAAwB;QACrD,qBAAqB,IAAI,CAAC,KAAK,2CAA2C;QAC1E,qBAAqB,IAAI,CAAC,KAAK,2CAA2C,CAC7E,CACF,CAAC,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,CAC3C;SACA,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,IAAI,KAAK,IAAI,CAAC;SAC7B,GAAG,CAAC,IAAI,CAAC,EAAE;QACV,MAAM,UAAU,GACd,WAAW,CACT,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YACzB,CAAC,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE;YACnC,CAAC,CAAC,MAAM,CAAC,OAAO,IAAI,EAAE,CACzB,EAAE,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,IAAI,EAAE,CAAC,IAAI,KAAK,CAAC;QAE3D,MAAM,KAAK,GAAG,QAAQ,CAAC,MAAM,CAAC,aAAa,EAAE,IAAI,CAAC,CAAC;QACnD,MAAM,QAAQ,GAAG,KAAK,EAAE,aAAa,KAAK,MAAM,CAAC;QAEjD,OAAO;YACL,QAAQ;YACR,QAAQ,EAAE,KAAK,KAAK,IAAI,IAAI,CAAC,QAAQ;YACrC,QAAQ,EAAE,UAAU;YACpB,OAAO,EAAE,IAAI;SACd,CAAC;IACJ,CAAC,CAAC;SACD,IAAI,CAAC,OAAO,CAAC,CAAC;IAEjB,MAAM,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,EAAE;QACrC,OAAO,IAAI,CAAA;kBACG,IAAI,CAAC,QAAQ;kBACb,IAAI,CAAC,QAAQ;eAChB,QAAQ,CAAC,IAAI,CAAC,OAAO,CAAC;;;WAG1B,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,QAAQ,CAAC;YACtC,EAAE,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CAAC,SAAS,CAAC,GAAG,IAAI,CAAC,OAAO,CAAC,YAAY,CACnE,MAAM,CACP,IAAI,EAAE;UACL,IAAI,CAAC,QAAQ;YACb,CAAC,CAAC,IAAI,CAAA;;;gBAGA,aAAa,CAAC,QAAQ,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAE,CAAC,EAAE;YACnD,CAAC,CAAC,EAAE;;WAEH,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,KAAK,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,EAAE;UACxD,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC;YAC/B,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,SAAS,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC;YACvD,CAAC,CAAC,QAAQ;;MAEd,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,MAAM,CAAC,IAAI,CAAA,GAAG,WAAW,EAAE,EAAE,MAAM,CAAC,CAAC;AACvC,CAAC;AAED,SAAS,aAAa,CAAC,OAAgB;IACrC,MAAM,GAAG,GAAG,OAAO,CAAC,aAAa,CAAC;IAClC,IAAI,GAAG,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC,MAAM,GAAG,CAAC;QAChD,OAAO,IAAI,CAAA;;;;kBAIG,CAAC,GAAuB,EAAE,EAAE,CAAC,WAAW,CAAC,GAAG,EAAE,OAAO,CAAC;SAC/D,KAAK,CAAC,IAAI,CAAC,GAAG,CAAC,gBAAgB,CAAC,aAAa,CAAC,CAAC;aAC/C,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,YAAY,CAAC,MAAM,CAAE,CAAC;aACrC,GAAG,CAAC,OAAO,CAAC,EAAE;YACb,OAAO;gBACL,QAAQ,EACN,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC;qBACzB,MAAM,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;qBACxC,MAAM,CACL,IAAI,CAAC,EAAE,CACL,IAAI,CAAC,OAAO,KAAK,OAAO;oBACxB,IAAI,CAAC,YAAY,CAAC,SAAS,CAAC,KAAK,OAAO,CAC3C,CAAC,MAAM,GAAG,CAAC;gBAChB,OAAO,EAAE,OAAO;aACjB,CAAC;QACJ,CAAC,CAAC;aACD,IAAI,CAAC,OAAO,CAAC;aACb,GAAG,CACF,IAAI,CAAC,EAAE,CACL,IAAI,CAAA;uBACO,IAAI,CAAC,OAAO,IAAI,EAAE;0BACf,IAAI,CAAC,QAAQ;iBACtB,IAAI,CAAC,OAAO;cACf,CACL;MACH,CAAC;;QAEH,OAAO,IAAI,CAAA;cACD,SAAS,CAAC,0BAA0B,CAAC;;qBAE9B,CAAC;AACtB,CAAC;AAED,kEAAkE;AAClE,MAAM,UAAU,WAAW,CAAC,OAAgB;IAC1C,OAAO;QACL;YACE,KAAK,EAAE,GAAG,CAAC,+BAA+B,CAAC;YAC3C,OAAO;YACP,OAAO,EAAE,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;SAClC;QACD;YACE,OAAO,EAAE,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC,IAAI,CACxC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,OAAO,KAAK,OAAO,CACnC;YACD,KAAK,EAAE,GAAG,CAAC,8BAA8B,CAAC;YAC1C,OAAO;YACP,OAAO,EAAE;gBACP,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,GAAG,CAAC,MAAM,CAAC;gBAClB,MAAM,EAAE,iBAAiB,CAAC,OAAO,CAAC;aACnC;YACD,OAAO,EAAE,CAAC,IAAI,CAAA,mDAAmD,CAAC;SACnE;KACF,CAAC;AACJ,CAAC","sourcesContent":["import { html, render, TemplateResult } from 'lit-html';\nimport { get, translate } from 'lit-translate';\n\nimport {\n  createElement,\n  EditorAction,\n  getChildElementsByTagName,\n  identity,\n  isPublic,\n  referencePath,\n  selector,\n  Wizard,\n  WizardActor,\n  WizardInput,\n} from '../foundation.js';\n\nimport { List } from '@material/mwc-list';\nimport { ListBase } from '@material/mwc-list/mwc-list-base';\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\nimport { MultiSelectedEvent } from '@material/mwc-list/mwc-list-foundation';\n\n/** Description of a `ListItem` representing an `IED` or `LN[0]` */\ninterface ItemDescription {\n  selected: boolean;\n  disabled?: boolean;\n  preferred?: boolean;\n  element?: Element;\n}\n\n/** Logical nodes perferred for lnode reference to substation element */\nconst preferredLn: Partial<Record<string, string[]>> = {\n  CBR: ['CSWI', 'CILO', 'XCBR'],\n  DIS: ['CSWI', 'CILO', 'XSWI'],\n  VTR: ['TVTR'],\n  CTR: ['TCTR'],\n  Bay: ['LLN0'],\n  VoltageLevel: ['LLN0'],\n  Substation: ['LLN0'],\n};\n\n/** Sorts selected `ListItem`s to the top and disabled ones to the bottom. */\nfunction compare(a: ItemDescription, b: ItemDescription): number {\n  if (a.disabled !== b.disabled) return b.disabled ? -1 : 1;\n\n  if (a.preferred !== b.preferred) return a.preferred ? -1 : 1;\n\n  if (a.selected !== b.selected) return a.selected ? -1 : 1;\n\n  return 0;\n}\n\nconst APldInst = 'Client LN';\n\n/** Queries `parent` for an `LNode` described by logical node element. */\nexport function getLNode(\n  parent: Element | XMLDocument,\n  anyln: Element\n): Element | null {\n  return (\n    Array.from(parent.getElementsByTagName('LNode'))\n      .filter(item => !item.closest('Private'))\n      .filter(lnode => isLNodeReference(anyln, lnode))[0] ?? null\n  );\n}\n\nfunction isLNodeReference(anyln: Element, lnode: Element): boolean {\n  return (\n    (lnode.getAttribute('iedName') ?? '') ===\n      (anyln.closest('IED')?.getAttribute('name') ?? '') &&\n    (lnode.getAttribute('ldInst') ?? '') ===\n      (anyln.closest('LDevice')?.getAttribute('inst') ?? '') &&\n    (lnode.getAttribute('prefix') ?? '') ===\n      (anyln.getAttribute('prefix') ?? '') &&\n    (lnode.getAttribute('lnClass') ?? '') ===\n      (anyln.getAttribute('lnClass') ?? '') &&\n    (lnode.getAttribute('lnInst') ?? '') === (anyln.getAttribute('inst') ?? '')\n  );\n}\n\nfunction createAction(parent: Element, anyln: Element): EditorAction {\n  const element = createElement(parent.ownerDocument, 'LNode', {\n    iedName: anyln.closest('IED')?.getAttribute('name') ?? '',\n    ldInst: anyln.closest('LDevice')?.getAttribute('inst') ?? '',\n    prefix: anyln.getAttribute('prefix') ?? '',\n    lnClass: anyln.getAttribute('lnClass') ?? '',\n    lnInst: anyln.getAttribute('inst') ?? '',\n  });\n\n  return {\n    new: {\n      parent,\n      element,\n    },\n  };\n}\n\nfunction deleteAction(parent: Element, lnode: Element): EditorAction {\n  return {\n    old: {\n      parent: parent,\n      element: lnode,\n      reference: lnode.nextElementSibling,\n    },\n  };\n}\n\nfunction includesAnyLN(anylns: Element[], lnode: Element): boolean {\n  return anylns.some(anyln => isLNodeReference(anyln, lnode));\n}\n\nfunction includesLNode(anyln: Element, lnodes: Element[]): boolean {\n  return lnodes.some(lnode => isLNodeReference(anyln, lnode));\n}\n\n/**\n * @returns a `WizardAction` updating `parent`'s `LNodes`\n * to the entries selected in `wizard`'s `#lnList`.\n */\nexport function lNodeWizardAction(parent: Element): WizardActor {\n  return (\n    inputs: WizardInput[],\n    wizard: Element,\n    list?: List | null\n  ): EditorAction[] => {\n    const selectedAnyLn = <Element[]>list!.items\n      .filter(item => item.selected)\n      .map(item => item.value)\n      .map(identity => {\n        return parent.ownerDocument.querySelector(selector('LN0', identity))\n          ? parent.ownerDocument.querySelector(selector('LN0', identity))\n          : parent.ownerDocument.querySelector(selector('LN', identity));\n      })\n      .filter(item => item !== null);\n\n    const oldLNodes = getChildElementsByTagName(parent, 'LNode').filter(\n      isPublic\n    );\n\n    const deleteActions = oldLNodes\n      .filter(lnode => !includesAnyLN(selectedAnyLn, lnode))\n      .map(lnode => deleteAction(parent, lnode));\n    const createActions = selectedAnyLn\n      .filter(anyln => !includesLNode(anyln, oldLNodes))\n      .map(anyln => createAction(parent, anyln));\n\n    return deleteActions.concat(createActions);\n  };\n}\n\nfunction getListContainer(target: Element, selector: string): Element | null {\n  return (\n    target.parentElement?.parentElement?.nextElementSibling?.querySelector(\n      selector\n    ) ?? null\n  );\n}\n\nfunction onIEDSelect(evt: MultiSelectedEvent, parent: Element): void {\n  if (!(evt.target instanceof ListBase)) return;\n  const lnList = getListContainer(evt.target, '#lnList');\n  if (lnList === null) return;\n\n  const doc = parent.ownerDocument;\n\n  const selectedIEDItems = <ListItem[]>evt.target.selected;\n\n  const lnItems = selectedIEDItems\n    .flatMap(item =>\n      Array.from(\n        doc.querySelectorAll(\n          `:root > IED[name=\"${item.value}\"] > AccessPoint > LN,` +\n            `:root > IED[name=\"${item.value}\"] > AccessPoint > Server > LDevice > LN,` +\n            `:root > IED[name=\"${item.value}\"] > AccessPoint > Server > LDevice > LN0`\n        )\n      ).filter(item => !item.closest('Private'))\n    )\n    .filter(item => item !== null)\n    .map(item => {\n      const isPrefered =\n        preferredLn[\n          parent.getAttribute('type')\n            ? parent.getAttribute('type') ?? ''\n            : parent.tagName ?? ''\n        ]?.includes(item.getAttribute('lnClass') ?? '') ?? false;\n\n      const lnode = getLNode(parent.ownerDocument, item);\n      const selected = lnode?.parentElement === parent;\n\n      return {\n        selected,\n        disabled: lnode !== null && !selected,\n        prefered: isPrefered,\n        element: item,\n      };\n    })\n    .sort(compare);\n\n  const lnTemplates = lnItems.map(item => {\n    return html`<mwc-check-list-item\n      ?selected=${item.selected}\n      ?disabled=${item.disabled}\n      value=\"${identity(item.element)}\"\n      twoline\n      ><span\n        >${item.element.getAttribute('prefix') ??\n        ''}${item.element.getAttribute('lnClass')}${item.element.getAttribute(\n          'inst'\n        ) ?? ''}\n        ${item.disabled\n          ? html` <mwc-icon style=\"--mdc-icon-size: 1em;\"\n                >account_tree</mwc-icon\n              >\n              ${referencePath(getLNode(doc, item.element)!)}`\n          : ''}</span\n      ><span slot=\"secondary\"\n        >${item.element.closest('IED')?.getAttribute('name') ?? ''} |\n        ${item.element.closest('LDevice')\n          ? item.element.closest('LDevice')?.getAttribute('inst')\n          : APldInst}</span\n      ></mwc-check-list-item\n    >`;\n  });\n\n  render(html`${lnTemplates}`, lnList);\n}\n\nfunction renderIEDPage(element: Element): TemplateResult {\n  const doc = element.ownerDocument;\n  if (doc.querySelectorAll(':root > IED').length > 0)\n    return html`<filtered-list\n      disableCheckAll\n      multi\n      id=\"iedList\"\n      @selected=${(evt: MultiSelectedEvent) => onIEDSelect(evt, element)}\n      >${Array.from(doc.querySelectorAll(':root > IED'))\n        .map(ied => ied.getAttribute('name')!)\n        .map(iedName => {\n          return {\n            selected:\n              Array.from(element.children)\n                .filter(item => !item.closest('Private'))\n                .filter(\n                  item =>\n                    item.tagName === 'LNode' &&\n                    item.getAttribute('iedName') === iedName\n                ).length > 0,\n            iedName: iedName,\n          };\n        })\n        .sort(compare)\n        .map(\n          item =>\n            html`<mwc-check-list-item\n              value=\"${item.iedName ?? ''}\"\n              ?selected=${item.selected}\n              >${item.iedName}</mwc-check-list-item\n            >`\n        )}</filtered-list\n    >`;\n  else\n    return html`<mwc-list-item noninteractive graphic=\"icon\">\n      <span>${translate('lnode.wizard.placeholder')}</span>\n      <mwc-icon slot=\"graphic\">info</mwc-icon>\n    </mwc-list-item>`;\n}\n\n/** @returns a Wizard for editing `element`'s `LNode` children. */\nexport function lNodeWizard(element: Element): Wizard {\n  return [\n    {\n      title: get('lnode.wizard.title.selectIEDs'),\n      element,\n      content: [renderIEDPage(element)],\n    },\n    {\n      initial: Array.from(element.children).some(\n        child => child.tagName === 'LNode'\n      ),\n      title: get('lnode.wizard.title.selectLNs'),\n      element,\n      primary: {\n        icon: 'save',\n        label: get('save'),\n        action: lNodeWizardAction(element),\n      },\n      content: [html`<filtered-list multi id=\"lnList\"></filtered-list>`],\n    },\n  ];\n}\n"]}