{"version":3,"file":"open-scd.js","sourceRoot":"","sources":["../../src/open-scd.ts"],"names":[],"mappings":";AAAA,OAAO,EACL,GAAG,EACH,aAAa,EACb,IAAI,EACJ,UAAU,EACV,QAAQ,GAET,MAAM,aAAa,CAAC;AAErB,OAAO,sBAAsB,CAAC;AAC9B,OAAO,wBAAwB,CAAC;AAChC,OAAO,4CAA4C,CAAC;AACpD,OAAO,sBAAsB,CAAC;AAC9B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,mBAAmB,CAAC;AAC3B,OAAO,yBAAyB,CAAC;AACjC,OAAO,oBAAoB,CAAC;AAC5B,OAAO,2BAA2B,CAAC;AACnC,OAAO,kCAAkC,CAAC;AAC1C,OAAO,+BAA+B,CAAC;AACvC,OAAO,oBAAoB,CAAC;AAC5B,OAAO,wCAAwC,CAAC;AAChD,OAAO,kCAAkC,CAAC;AAC1C,OAAO,wCAAwC,CAAC;AAChD,OAAO,oBAAoB,CAAC;AAC5B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,wBAAwB,CAAC;AAChC,OAAO,sBAAsB,CAAC;AAC9B,OAAO,mBAAmB,CAAC;AAC3B,OAAO,uBAAuB,CAAC;AAC/B,OAAO,yBAAyB,CAAC;AACjC,OAAO,iCAAiC,CAAC;AAEzC,OAAO,oBAAoB,CAAC;AAC5B,OAAO,oBAAoB,CAAC;AAC5B,OAAO,uBAAuB,CAAC;AAC/B,OAAO,oBAAoB,CAAC;AAC5B,OAAO,kBAAkB,CAAC;AAE1B,OAAO,EAAE,eAAe,EAAE,oBAAoB,EAAE,MAAM,iBAAiB,CAAC;AACxE,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAC;AAEvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,QAAQ,EAAE,MAAM,eAAe,CAAC;AACzC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAI3C;6CAC6C;AAE7C,IAAa,OAAO,GAApB,MAAa,OAAQ,SAAQ,OAAO,CAClC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,QAAQ,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CACpE;IAuDC;QACE,KAAK,EAAE,CAAC;QAvDF,eAAU,GAAG,EAAE,CAAC;QAyDtB,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC;IAC3C,CAAC;IA1DD,wEAAwE;IAExE,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IACD,IAAI,GAAG,CAAC,KAAa;QACnB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAChE,CAAC;IAED,qEAAqE;IAC7D,KAAK,CAAC,OAAO,CAAC,GAAW;QAC/B,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,CAAC;QAClC,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,IAAI,EAAE,CAAC;QACnC,IAAI,CAAC,IAAI;YAAE,OAAO;QAElB,MAAM,GAAG,GAAG,IAAI,SAAS,EAAE,CAAC,eAAe,CAAC,IAAI,EAAE,iBAAiB,CAAC,CAAC;QACrE,MAAM,OAAO,GAAG,GAAG,CAAC;QACpB,IAAI,CAAC,aAAa,CAAC,eAAe,CAAC,GAAG,EAAE,OAAO,CAAC,CAAC,CAAC;QAElD,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC;YAAE,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;IACxD,CAAC;IAEO,cAAc,CAAC,CAAgB;QACrC,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,MAAM,OAAO,GAAG,CAAC,GAAW,EAAE,EAAE,CAC9B,CAAC,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC;QAEjD,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QAC3E,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,IAAI,CAAC,YAAY,CAAC,IAAI;gBACpB,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE;gBAC3B,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,EAAE,CAAC;QAC/B,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QACvD,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,IAAI,CAAC,MAAM;iBACR,aAAa,CAAW,qCAAqC,CAAC;gBAC/D,EAAE,KAAK,EAAE,CAAC;QACd,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,IAAI,CAAC,MAAM;iBACR,aAAa,CAAW,2CAA2C,CAAC;gBACrE,EAAE,KAAK,EAAE,CAAC;QACd,IAAI,OAAO,CAAC,GAAG,CAAC;YACd,IAAI,CAAC,MAAM;iBACR,aAAa,CAAW,8BAA8B,CAAC;gBACxD,EAAE,KAAK,EAAE,CAAC;QACd,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QAEvC,IAAI,OAAO;YAAE,CAAC,CAAC,cAAc,EAAE,CAAC;IAClC,CAAC;IASD,MAAM;QACJ,OAAO,IAAI,CAAA,IAAI,KAAK,CAAC,MAAM,EAAE,IAAI,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,GAAG,CAAC;IACpE,CAAC;CAkFF,CAAA;AAhFQ,cAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA+ElB,CAAC;AA7IF;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;kCAG1B;AARU,OAAO;IADnB,aAAa,CAAC,UAAU,CAAC;GACb,OAAO,CAoJnB;SApJY,OAAO","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  TemplateResult,\n} from 'lit-element';\n\nimport '@material/mwc-button';\nimport '@material/mwc-checkbox';\nimport '@material/mwc-circular-progress-four-color';\nimport '@material/mwc-dialog';\nimport '@material/mwc-drawer';\nimport '@material/mwc-fab';\nimport '@material/mwc-formfield';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-icon-button-toggle';\nimport '@material/mwc-linear-progress';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-check-list-item';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-list/mwc-radio-list-item';\nimport '@material/mwc-menu';\nimport '@material/mwc-select';\nimport '@material/mwc-snackbar';\nimport '@material/mwc-switch';\nimport '@material/mwc-tab';\nimport '@material/mwc-tab-bar';\nimport '@material/mwc-textfield';\nimport '@material/mwc-top-app-bar-fixed';\n\nimport './filtered-list.js';\nimport './wizard-dialog.js';\nimport './wizard-textfield.js';\nimport './wizard-select.js';\nimport './finder-pane.js';\n\nimport { newOpenDocEvent, newPendingStateEvent } from './foundation.js';\nimport { getTheme } from './themes.js';\n\nimport { Editing } from './Editing.js';\nimport { Hosting } from './Hosting.js';\nimport { Logging } from './Logging.js';\nimport { Plugging } from './Plugging.js';\nimport { Setting } from './Setting.js';\nimport { Waiting } from './Waiting.js';\nimport { Wizarding } from './Wizarding.js';\n\nimport { ListItem } from '@material/mwc-list/mwc-list-item';\n\n/** The `<open-scd>` custom element is the main entry point of the\n * Open Substation Configuration Designer. */\n@customElement('open-scd')\nexport class OpenSCD extends Hosting(\n  Setting(Wizarding(Waiting(Plugging(Editing(Logging(LitElement))))))\n) {\n  private currentSrc = '';\n  /** The current file's URL. `blob:` URLs are *revoked after parsing*! */\n  @property({ type: String })\n  get src(): string {\n    return this.currentSrc;\n  }\n  set src(value: string) {\n    this.currentSrc = value;\n    this.dispatchEvent(newPendingStateEvent(this.loadDoc(value)));\n  }\n\n  /** Loads and parses an `XMLDocument` after [[`src`]] has changed. */\n  private async loadDoc(src: string): Promise<void> {\n    const response = await fetch(src);\n    const text = await response.text();\n    if (!text) return;\n\n    const doc = new DOMParser().parseFromString(text, 'application/xml');\n    const docName = src;\n    this.dispatchEvent(newOpenDocEvent(doc, docName));\n\n    if (src.startsWith('blob:')) URL.revokeObjectURL(src);\n  }\n\n  private handleKeyPress(e: KeyboardEvent): void {\n    let handled = false;\n    const ctrlAnd = (key: string) =>\n      e.key === key && e.ctrlKey && (handled = true);\n\n    if (ctrlAnd('y')) this.redo();\n    if (ctrlAnd('z')) this.undo();\n    if (ctrlAnd('l')) this.logUI.open ? this.logUI.close() : this.logUI.show();\n    if (ctrlAnd('d'))\n      this.diagnosticUI.open\n        ? this.diagnosticUI.close()\n        : this.diagnosticUI.show();\n    if (ctrlAnd('m')) this.menuUI.open = !this.menuUI.open;\n    if (ctrlAnd('o'))\n      this.menuUI\n        .querySelector<ListItem>('mwc-list-item[iconid=\"folder_open\"]')\n        ?.click();\n    if (ctrlAnd('O'))\n      this.menuUI\n        .querySelector<ListItem>('mwc-list-item[iconid=\"create_new_folder\"]')\n        ?.click();\n    if (ctrlAnd('s'))\n      this.menuUI\n        .querySelector<ListItem>('mwc-list-item[iconid=\"save\"]')\n        ?.click();\n    if (ctrlAnd('P')) this.pluginUI.show();\n\n    if (handled) e.preventDefault();\n  }\n\n  constructor() {\n    super();\n\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    document.onkeydown = this.handleKeyPress;\n  }\n\n  render(): TemplateResult {\n    return html` ${super.render()} ${getTheme(this.settings.theme)} `;\n  }\n\n  static styles = css`\n    mwc-top-app-bar-fixed {\n      --mdc-theme-text-disabled-on-light: rgba(255, 255, 255, 0.38);\n    } /* hack to fix disabled icon buttons rendering black */\n\n    mwc-tab {\n      background-color: var(--primary);\n      --mdc-theme-primary: var(--mdc-theme-on-primary);\n    }\n\n    input[type='file'] {\n      display: none;\n    }\n\n    mwc-dialog {\n      --mdc-dialog-max-width: 98vw;\n    }\n\n    mwc-dialog > form {\n      display: flex;\n      flex-direction: column;\n    }\n\n    mwc-dialog > form > * {\n      display: block;\n      margin-top: 16px;\n    }\n\n    mwc-circular-progress-four-color {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 99;\n      pointer-events: none;\n    }\n\n    tt {\n      font-family: 'Roboto Mono', monospace;\n      font-weight: 300;\n    }\n\n    .landing {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      position: absolute;\n      top: calc(50vh - 82px);\n      left: calc(50vw - 184px);\n    }\n\n    .landing_icon:hover {\n      box-shadow: 0 12px 17px 2px rgba(0, 0, 0, 0.14),\n        0 5px 22px 4px rgba(0, 0, 0, 0.12), 0 7px 8px -4px rgba(0, 0, 0, 0.2);\n    }\n\n    .landing_icon {\n      margin: 12px;\n      border-radius: 16px;\n      width: 160px;\n      height: 140px;\n      text-align: center;\n      color: var(--mdc-theme-on-secondary);\n      background: var(--secondary);\n      --mdc-icon-button-size: 100px;\n      --mdc-icon-size: 100px;\n      --mdc-ripple-color: rgba(0, 0, 0, 0);\n      box-shadow: rgb(0 0 0 / 14%) 0px 6px 10px 0px,\n        rgb(0 0 0 / 12%) 0px 1px 18px 0px, rgb(0 0 0 / 20%) 0px 3px 5px -1px;\n      transition: box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .landing_label {\n      width: 160px;\n      height: 50px;\n      margin-top: 100px;\n      margin-left: -30px;\n      font-family: 'Roboto', sans-serif;\n    }\n  `;\n}\n"]}