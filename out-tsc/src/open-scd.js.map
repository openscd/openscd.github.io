{"version":3,"file":"open-scd.js","sourceRoot":"","sources":["../../src/open-scd.ts"],"names":[],"mappings":";AAAA,OAAO,EACL,UAAU,EACV,cAAc,EACd,GAAG,EACH,aAAa,EACb,IAAI,EACJ,QAAQ,EACR,KAAK,GACN,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,SAAS,EAAE,GAAG,EAAE,MAAM,eAAe,CAAC;AAC/C,OAAO,EAAE,KAAK,EAAE,MAAM,8BAA8B,CAAC;AAErD,OAAO,sBAAsB,CAAC;AAC9B,OAAO,sBAAsB,CAAC;AAC9B,OAAO,oBAAoB,CAAC;AAC5B,OAAO,2BAA2B,CAAC;AACnC,OAAO,+BAA+B,CAAC;AACvC,OAAO,oBAAoB,CAAC;AAC5B,OAAO,kCAAkC,CAAC;AAC1C,OAAO,mBAAmB,CAAC;AAC3B,OAAO,uBAAuB,CAAC;AAC/B,OAAO,iCAAiC,CAAC;AAIzC,OAAO,EAAE,OAAO,EAAE,WAAW,EAAE,MAAM,cAAc,CAAC;AACpD,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAC3C,OAAO,EAAE,QAAQ,EAAE,MAAM,aAAa,CAAC;AACvC,OAAO,EAAE,OAAO,EAAE,MAAM,cAAc,CAAC;AACvC,OAAO,EAAE,WAAW,EAAE,oBAAoB,EAAE,MAAM,iBAAiB,CAAC;AACpE,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,WAAW,EAAE,MAAM,eAAe,CAAC;AAC5C,OAAO,EAAE,YAAY,EAAE,MAAM,YAAY,CAAC;AAmB1C,IAAa,OAAO,GAApB,MAAa,OAAQ,SAAQ,OAAO,CAClC,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CACjD;IAuJC;QACE,KAAK,EAAE,CAAC;QAvJV,uCAAuC;QAEvC,cAAS,GAAG,CAAC,CAAC;QAKd,oCAAoC;QACR,YAAO,GAAG,cAAc,CAAC;QAC7C,eAAU,GAAG,EAAE,CAAC;QAsFxB,SAAI,GAAgB;YAClB;gBACE,IAAI,EAAE,aAAa;gBACnB,IAAI,EAAE,WAAW;gBACjB,WAAW,EAAE,IAAI;gBACjB,UAAU,EAAE,IAAI;gBAChB,MAAM,EAAE,GAAS,EAAE,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE;aACxC;YACD,EAAE,IAAI,EAAE,mBAAmB,EAAE,IAAI,EAAE,UAAU,EAAE;YAC/C,EAAE,IAAI,EAAE,gBAAgB,EAAE,IAAI,EAAE,gBAAgB,EAAE;YAClD,EAAE,IAAI,EAAE,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE;YAC9B;gBACE,IAAI,EAAE,MAAM;gBACZ,IAAI,EAAE,MAAM;gBACZ,WAAW,EAAE,IAAI;gBACjB,UAAU,EAAE,IAAI;gBAChB,MAAM,EAAE,IAAI,CAAC,IAAI;gBACjB,QAAQ,EAAE,GAAY,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO;aACvC;YACD;gBACE,IAAI,EAAE,MAAM;gBACZ,IAAI,EAAE,MAAM;gBACZ,UAAU,EAAE,IAAI;gBAChB,MAAM,EAAE,IAAI,CAAC,IAAI;gBACjB,QAAQ,EAAE,GAAY,EAAE,CAAC,CAAC,IAAI,CAAC,OAAO;aACvC;YACD,EAAE,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,eAAe,EAAE,WAAW,EAAE,IAAI,EAAE;YACjE;gBACE,IAAI,EAAE,MAAM;gBACZ,IAAI,EAAE,cAAc;gBACpB,UAAU,EAAE,IAAI;gBAChB,MAAM,EAAE,GAAS,EAAE,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE;aACtC;YACD;gBACE,IAAI,EAAE,UAAU;gBAChB,IAAI,EAAE,eAAe;gBACrB,WAAW,EAAE,IAAI;gBACjB,MAAM,EAAE,GAAS,EAAE,CAAC,IAAI,CAAC,UAAU,CAAC,IAAI,EAAE;aAC3C;SACF,CAAC;QAEF,YAAO,GAAG;YACR,OAAO,EAAE;gBACP;oBACE,IAAI,EAAE,iBAAiB;oBACvB,EAAE,EAAE,YAAY;oBAChB,IAAI,EAAE,YAAY;oBAClB,UAAU,EAAE,GAA4B,EAAE,CACxC,MAAM,CAAC,+BAA+B,EAAE,UAAU,CAAC,CAAC,IAAI,CACtD,GAAG,EAAE,CAAC,IAAI,CAAA,kBAAkB,IAAI,CAAC,GAAG,cAAc,CACnD;iBACJ;aACF;SACF,CAAC;QAKA,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;QACrD,QAAQ,CAAC,SAAS,GAAG,IAAI,CAAC,cAAc,CAAC;IAC3C,CAAC;IAvJD,IAAI,IAAI;QACN,OAAO,IAAI,CAAC,GAAG,CAAC,aAAa,CAAC,YAAY,CAAC,EAAE,YAAY,CAAC,MAAM,CAAC,IAAI,IAAI,CAAC;IAC5E,CAAC;IAID,wEAAwE;IAExE,IAAI,GAAG;QACL,OAAO,IAAI,CAAC,UAAU,CAAC;IACzB,CAAC;IACD,IAAI,GAAG,CAAC,KAAa;QACnB,IAAI,CAAC,UAAU,GAAG,KAAK,CAAC;QACxB,IAAI,CAAC,aAAa,CAAC,oBAAoB,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAChE,CAAC;IAKO,OAAO,CAAC,GAAW;QACzB,OAAO,IAAI,OAAO,CAChB,CAAC,OAA8B,EAAE,MAA6B,EAAE,EAAE;YAChE,IAAI,CAAC,KAAK,EAAE,CAAC;YACb,IAAI,CAAC,aAAa,CAChB,WAAW,CAAC;gBACV,IAAI,EAAE,MAAM;gBACZ,KAAK,EAAE,GAAG,CAAC,iBAAiB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC;aACtD,CAAC,CACH,CAAC;YACF,MAAM,MAAM,GAAe,IAAI,UAAU,EAAE,CAAC;YAC5C,MAAM,CAAC,gBAAgB,CAAC,MAAM,EAAE,GAAG,EAAE;gBACnC,IAAI,CAAC,GAAG,GAAG,MAAM,CAAC,MAAM;oBACtB,CAAC,CAAC,IAAI,SAAS,EAAE,CAAC,eAAe,CACrB,MAAM,CAAC,MAAM,EACrB,iBAAiB,CAClB;oBACH,CAAC,CAAC,WAAW,EAAE,CAAC;gBAClB,iCAAiC;gBACjC,IAAI,GAAG,CAAC,UAAU,CAAC,OAAO,CAAC;oBAAE,GAAG,CAAC,eAAe,CAAC,GAAG,CAAC,CAAC;gBACtD,IAAI,CAAC,aAAa,CAChB,WAAW,CAAC;oBACV,IAAI,EAAE,MAAM;oBACZ,KAAK,EAAE,GAAG,CAAC,gBAAgB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC;iBACrD,CAAC,CACH,CAAC;gBACF,WAAW,CAAC,IAAI,CAAC,GAAG,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE;oBAChD,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE;wBACd,IAAI,CAAC,aAAa,CAAC,WAAW,CAAC,EAAE,CAAC,CAAC,CAAC;oBACtC,CAAC,CAAC,CAAC;oBACH,IAAI,MAAM,CAAC,MAAM,IAAI,CAAC;wBACpB,OAAO,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;;wBACvD,MAAM,CAAC,GAAG,CAAC,qBAAqB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;gBAClE,CAAC,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YACH,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,CACpC,MAAM,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CACzD,CAAC;YACF,MAAM,CAAC,gBAAgB,CAAC,OAAO,EAAE,GAAG,EAAE,CACpC,MAAM,CAAC,GAAG,CAAC,mBAAmB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,OAAO,EAAE,CAAC,CAAC,CACzD,CAAC;YACF,KAAK,CAAC,GAAG,IAAI,EAAE,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAC1B,GAAG,CAAC,IAAI,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,MAAM,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC,CAC3C,CAAC;QACJ,CAAC,CACF,CAAC;IACJ,CAAC;IAED,gEAAgE;IACxD,QAAQ,CAAC,KAAY;QAC3B,MAAM,IAAI,GACkB,KAAK,CAAC,MAAO,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC,CAAC,IAAI,KAAK,CAAC;QACnE,IAAI,IAAI,EAAE;YACR,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,IAAI,CAAC;YACzB,IAAI,CAAC,YAAY,CAAC,KAAK,EAAE,GAAG,CAAC,eAAe,CAAC,IAAI,CAAC,CAAC,CAAC;SACrD;IACH,CAAC;IAEO,cAAc,CAAC,CAAgB;QACrC,IAAI,OAAO,GAAG,KAAK,CAAC;QACpB,MAAM,OAAO,GAAG,CAAC,GAAW,EAAE,EAAE,CAC9B,CAAC,CAAC,GAAG,KAAK,GAAG,IAAI,CAAC,CAAC,OAAO,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,CAAC;QAEjD,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,IAAI,EAAE,CAAC;QAC9B,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC;QAC3E,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC;QACvD,IAAI,OAAO,CAAC,GAAG,CAAC;YAAE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QAEtC,IAAI,OAAO;YAAE,CAAC,CAAC,cAAc,EAAE,CAAC;IAClC,CAAC;IAgED,eAAe,CAAC,EAAa;QAC3B,OAAO,IAAI,CAAA;QACP,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAA,2CAA2C,CAAC,CAAC,CAAC,EAAE;;kBAE3D,EAAE,CAAC,IAAI;;oBAEL,EAAE,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,CAAC,CAAC,KAAK,CAAC,CAAC,CAAC,IAAI,CAAC;mBAC9C,EAAE,CAAC,IAAI;qCACW,EAAE,CAAC,IAAI;gBAC5B,SAAS,CAAC,EAAE,CAAC,IAAI,CAAC;UACxB,EAAE,CAAC,IAAI;YACP,CAAC,CAAC,IAAI,CAAA,8BAA8B,EAAE,CAAC,IAAI,cAAc;YACzD,CAAC,CAAC,EAAE;;KAET,CAAC;IACJ,CAAC;IAED,gBAAgB,CAAC,EAAa;QAC5B,IAAI,EAAE,CAAC,UAAU;YACf,OAAO,IAAI,CAAA;;gBAED,EAAE,CAAC,IAAI;iBACN,EAAE,CAAC,IAAI;oBACJ,EAAE,CAAC,QAAQ,EAAE,EAAE,IAAI,CAAC,EAAE,CAAC,MAAM;iBAChC,EAAE,CAAC,MAAM;0BACA,CAAC;;YAClB,OAAO,IAAI,CAAA,EAAE,CAAC;IACrB,CAAC;IAED,eAAe,CAAC,MAAW;QACzB,OAAO,IAAI,CAAA;cACD,SAAS,CAAC,MAAM,CAAC,IAAI,CAAC;aACvB,MAAM,CAAC,IAAI,YAAY,cAAc,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI;WAC1D,MAAM,CAAC,EAAE;;;QAGZ,MAAM,CAAC,IAAI,YAAY,cAAc,CAAC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE;eACjD,CAAC;IACd,CAAC;IAED,MAAM;QACJ,OAAO,IAAI,CAAA;;6BAGL,IAAI,CAAC,IAAI,IAAI,IAAI,CAAA,GAAG,SAAS,CAAC,WAAW,CAAC,EAC5C;UACE,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI,CAAA,yBAAyB,IAAI,CAAC,OAAO,SAAS,CAAC,CAAC,CAAC,EAAE;;;oBAGzD,CAAC,EAA6B,EAAE,EAAE,CAC1C,IAAI,CAAC,IAAI,CAAC,EAAE,CAAC,MAAM,CAAC,KAAK,CAAC,EAAE,MAAO,EAAE;YACrC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC;;;;;;;;qBAQ1B,GAAG,EAAE,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,GAAG,IAAI,CAAC;;yCAEX,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,OAAO;YACtD,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,gBAAgB,CAAC;;mCAEb,CAAC,CAAc,EAAE,EAAE,CACxC,CAAC,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC;cACjC,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,eAAe,CAAC;;;;;QAKpD,KAAK,CACL,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,UAAU,EAAE,EACjD,IAAI,CAAA,2DAA2D,CAChE;;oDAE6C,IAAI,CAAC,QAAQ;QACzD,KAAK,CAAC,MAAM,EAAE;QACd,QAAQ,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC;KAChC,CAAC;IACJ,CAAC;CA2CF,CAAA;AAzCQ,cAAM,GAAG,GAAG,CAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GAwClB,CAAC;AArRF;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;0CACb;AAEd;IADC,QAAQ,EAAE;mCAGV;AAE2B;IAA3B,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;wCAA0B;AAIrD;IADC,QAAQ,CAAC,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC;kCAG1B;AAMe;IAAf,KAAK,CAAC,OAAO,CAAC;uCAAiB;AACV;IAArB,KAAK,CAAC,aAAa,CAAC;uCAA2B;AAxBrC,OAAO;IADnB,aAAa,CAAC,UAAU,CAAC;GACb,OAAO,CA2RnB;SA3RY,OAAO","sourcesContent":["import {\n  LitElement,\n  TemplateResult,\n  css,\n  customElement,\n  html,\n  property,\n  query,\n} from 'lit-element';\nimport { translate, get } from 'lit-translate';\nimport { until } from 'lit-html/directives/until.js';\n\nimport '@material/mwc-button';\nimport '@material/mwc-drawer';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-linear-progress';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-tab';\nimport '@material/mwc-tab-bar';\nimport '@material/mwc-top-app-bar-fixed';\nimport { ActionDetail } from '@material/mwc-list/mwc-list-foundation';\nimport { Drawer } from '@material/mwc-drawer';\n\nimport { Editing, newEmptySCD } from './Editing.js';\nimport { Logging } from './Logging.js';\nimport { Waiting } from './Waiting.js';\nimport { Wizarding } from './Wizarding.js';\nimport { getTheme } from './themes.js';\nimport { Setting } from './Setting.js';\nimport { newLogEvent, newPendingStateEvent } from './foundation.js';\nimport { plugin } from './plugin.js';\nimport { validateSCL } from './validate.js';\nimport { zeroLineIcon } from './icons.js';\n\ninterface Tab {\n  name: string;\n  id: string;\n  icon: string | TemplateResult;\n}\n\ninterface MenuEntry {\n  icon: string;\n  name: string;\n  hint?: string;\n  startsGroup?: boolean;\n  actionItem?: boolean;\n  action?: () => void;\n  disabled?: () => boolean;\n}\n\n@customElement('open-scd')\nexport class OpenSCD extends Setting(\n  Wizarding(Waiting(Editing(Logging(LitElement))))\n) {\n  /** The currently active editor tab. */\n  @property({ type: Number })\n  activeTab = 0;\n  @property()\n  get name(): string | null {\n    return this.doc.querySelector('Substation')?.getAttribute('name') ?? null;\n  }\n  /** The name of the current file. */\n  @property({ type: String }) srcName = 'untitled.scd';\n  private currentSrc = '';\n  /** The current file's URL. `blob:` URLs are *revoked after parsing*! */\n  @property({ type: String })\n  get src(): string {\n    return this.currentSrc;\n  }\n  set src(value: string) {\n    this.currentSrc = value;\n    this.dispatchEvent(newPendingStateEvent(this.loadDoc(value)));\n  }\n\n  @query('#menu') menuUI!: Drawer;\n  @query('#file-input') fileUI!: HTMLInputElement;\n\n  private loadDoc(src: string): Promise<string> {\n    return new Promise<string>(\n      (resolve: (msg: string) => void, reject: (msg: string) => void) => {\n        this.reset();\n        this.dispatchEvent(\n          newLogEvent({\n            kind: 'info',\n            title: get('openSCD.loading', { name: this.srcName }),\n          })\n        );\n        const reader: FileReader = new FileReader();\n        reader.addEventListener('load', () => {\n          this.doc = reader.result\n            ? new DOMParser().parseFromString(\n                <string>reader.result,\n                'application/xml'\n              )\n            : newEmptySCD();\n          // free blob memory after parsing\n          if (src.startsWith('blob:')) URL.revokeObjectURL(src);\n          this.dispatchEvent(\n            newLogEvent({\n              kind: 'info',\n              title: get('openSCD.loaded', { name: this.srcName }),\n            })\n          );\n          validateSCL(this.doc, this.srcName).then(errors => {\n            errors.map(id => {\n              this.dispatchEvent(newLogEvent(id));\n            });\n            if (errors.length == 0)\n              resolve(get('openSCD.validated', { name: this.srcName }));\n            else reject(get('openSCD.invalidated', { name: this.srcName }));\n          });\n        });\n        reader.addEventListener('error', () =>\n          reject(get('openSCD.readError', { name: this.srcName }))\n        );\n        reader.addEventListener('abort', () =>\n          reject(get('openSCD.readAbort', { name: this.srcName }))\n        );\n        fetch(src ?? '').then(res =>\n          res.blob().then(b => reader.readAsText(b))\n        );\n      }\n    );\n  }\n\n  /** Loads the file selected by input `event.target.files[0]`. */\n  private loadFile(event: Event): void {\n    const file =\n      (<HTMLInputElement | null>event.target)?.files?.item(0) ?? false;\n    if (file) {\n      this.srcName = file.name;\n      this.setAttribute('src', URL.createObjectURL(file));\n    }\n  }\n\n  private handleKeyPress(e: KeyboardEvent): void {\n    let handled = false;\n    const ctrlAnd = (key: string) =>\n      e.key === key && e.ctrlKey && (handled = true);\n\n    if (ctrlAnd('y')) this.redo();\n    if (ctrlAnd('z')) this.undo();\n    if (ctrlAnd('l')) this.logUI.open ? this.logUI.close() : this.logUI.show();\n    if (ctrlAnd('m')) this.menuUI.open = !this.menuUI.open;\n    if (ctrlAnd('o')) this.fileUI.click();\n\n    if (handled) e.preventDefault();\n  }\n\n  menu: MenuEntry[] = [\n    {\n      icon: 'folder_open',\n      name: 'menu.open',\n      startsGroup: true,\n      actionItem: true,\n      action: (): void => this.fileUI.click(),\n    },\n    { icon: 'create_new_folder', name: 'menu.new' },\n    { icon: 'snippet_folder', name: 'menu.importIED' },\n    { icon: 'save', name: 'save' },\n    {\n      icon: 'undo',\n      name: 'undo',\n      startsGroup: true,\n      actionItem: true,\n      action: this.undo,\n      disabled: (): boolean => !this.canUndo,\n    },\n    {\n      icon: 'redo',\n      name: 'redo',\n      actionItem: true,\n      action: this.redo,\n      disabled: (): boolean => !this.canRedo,\n    },\n    { icon: 'rule_folder', name: 'menu.validate', startsGroup: true },\n    {\n      icon: 'rule',\n      name: 'menu.viewLog',\n      actionItem: true,\n      action: (): void => this.logUI.show(),\n    },\n    {\n      icon: 'settings',\n      name: 'settings.name',\n      startsGroup: true,\n      action: (): void => this.settingsUI.show(),\n    },\n  ];\n\n  plugins = {\n    editors: [\n      {\n        name: 'substation.name',\n        id: 'substation',\n        icon: zeroLineIcon,\n        getContent: (): Promise<TemplateResult> =>\n          plugin('./editors/SubstationEditor.js', 'editor-0').then(\n            () => html`<editor-0 .doc=${this.doc}></editor-0>`\n          ),\n      },\n    ],\n  };\n\n  constructor() {\n    super();\n\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    document.onkeydown = this.handleKeyPress;\n  }\n\n  renderMenuEntry(me: MenuEntry): TemplateResult {\n    return html`\n      ${me.startsGroup ? html`<li divider padded role=\"separator\"></li>` : ''}\n      <mwc-list-item\n        iconid=\"${me.icon}\"\n        graphic=\"icon\"\n        .disabled=${me.disabled?.() || (me.action ? false : true)}\n        ?twoline=${me.hint}\n        ><mwc-icon slot=\"graphic\"> ${me.icon} </mwc-icon>\n        <span>${translate(me.name)}</span>\n        ${me.hint\n          ? html`<span slot=\"secondary\"><tt>${me.hint}</tt></span>`\n          : ''}\n      </mwc-list-item>\n    `;\n  }\n\n  renderActionItem(me: MenuEntry): TemplateResult {\n    if (me.actionItem)\n      return html`<mwc-icon-button\n        slot=\"actionItems\"\n        icon=\"${me.icon}\"\n        label=\"${me.name}\"\n        ?disabled=${me.disabled?.() || !me.action}\n        @click=${me.action}\n      ></mwc-icon-button>`;\n    else return html``;\n  }\n\n  renderEditorTab(editor: Tab): TemplateResult {\n    return html`<mwc-tab\n      label=${translate(editor.name)}\n      icon=${editor.icon instanceof TemplateResult ? '' : editor.icon}\n      id=${editor.id}\n      hasimageicon\n    >\n      ${editor.icon instanceof TemplateResult ? editor.icon : ''}\n    </mwc-tab>`;\n  }\n\n  render(): TemplateResult {\n    return html`\n      <mwc-drawer class=\"mdc-theme--surface\" hasheader type=\"modal\" id=\"menu\">\n        <span slot=\"title\">${\n          this.name ?? html`${translate('menu.name')}`\n        }</span>\n        ${this.name ? html`<span slot=\"subtitle\">${this.srcName}</span>` : ''}\n        <mwc-list\n          wrapFocus\n          @action=${(ae: CustomEvent<ActionDetail>) =>\n            this.menu[ae.detail.index]?.action!()}\n        > ${this.menu.map(this.renderMenuEntry)}\n        </mwc-list>\n\n        <mwc-top-app-bar-fixed slot=\"appContent\">\n          <mwc-icon-button\n            icon=\"menu\"\n            label=\"Menu\"\n            slot=\"navigationIcon\"\n            @click=${() => (this.menuUI.open = true)}\n          ></mwc-icon-button>\n          <div slot=\"title\" id=\"title\">${this.name ?? this.srcName}</div>\n          ${this.menu.map(this.renderActionItem)}\n          <mwc-tab-bar\n            @MDCTabBar:activated=${(e: CustomEvent) =>\n              (this.activeTab = e.detail.index)}\n          > ${this.plugins.editors.map(this.renderEditorTab)}\n          </mwc-tab-bar>\n        </mwc-top-app-bar-fixed>\n      </mwc-drawer>\n\n      ${until(\n        this.plugins.editors[this.activeTab].getContent(),\n        html`<mwc-linear-progress indeterminate></mwc-linear-progress>`\n      )}\n\n      <input id=\"file-input\" type=\"file\" @change=\"${this.loadFile}\"></input>\n      ${super.render()}\n      ${getTheme(this.settings.theme)}\n    `;\n  }\n\n  static styles = css`\n    mwc-top-app-bar-fixed {\n      --mdc-theme-text-disabled-on-light: rgba(255, 255, 255, 0.38);\n    } /* hack to fix disabled icon buttons rendering black */\n\n    mwc-tab {\n      background-color: var(--blue);\n      --mdc-theme-primary: var(--mdc-theme-on-primary);\n    }\n\n    #file-input {\n      display: none;\n    }\n\n    mwc-dialog {\n      --mdc-dialog-max-width: 92vw;\n    }\n\n    mwc-dialog > form {\n      display: flex;\n      flex-direction: column;\n    }\n\n    mwc-dialog > form > * {\n      display: block;\n      margin-top: 16px;\n    }\n\n    mwc-circular-progress-four-color {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 1;\n    }\n\n    tt {\n      font-family: 'Roboto Mono', monospace;\n      font-weight: 300;\n    }\n  `;\n}\n"]}