{"version":3,"file":"open-scd.js","sourceRoot":"","sources":["../../src/open-scd.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  css,\n  customElement,\n  html,\n  LitElement,\n  property,\n  query,\n  TemplateResult,\n} from 'lit-element';\nimport { until } from 'lit-html/directives/until.js';\nimport { translate, get } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-checkbox';\nimport '@material/mwc-circular-progress-four-color';\nimport '@material/mwc-dialog';\nimport '@material/mwc-drawer';\nimport '@material/mwc-fab';\nimport '@material/mwc-formfield';\nimport '@material/mwc-icon';\nimport '@material/mwc-icon-button';\nimport '@material/mwc-icon-button-toggle';\nimport '@material/mwc-linear-progress';\nimport '@material/mwc-list';\nimport '@material/mwc-list/mwc-check-list-item';\nimport '@material/mwc-list/mwc-list-item';\nimport '@material/mwc-list/mwc-radio-list-item';\nimport '@material/mwc-menu';\nimport '@material/mwc-select';\nimport '@material/mwc-snackbar';\nimport '@material/mwc-switch';\nimport '@material/mwc-tab';\nimport '@material/mwc-tab-bar';\nimport '@material/mwc-textfield';\nimport '@material/mwc-top-app-bar-fixed';\n\nimport './filtered-list.js';\n\nimport { ActionDetail } from '@material/mwc-list/mwc-list-foundation';\nimport { Dialog } from '@material/mwc-dialog';\nimport { Drawer } from '@material/mwc-drawer';\nimport { ListItemBase } from '@material/mwc-list/mwc-list-item-base';\n\nimport {\n  EditorAction,\n  newLogEvent,\n  newPendingStateEvent,\n  newWizardEvent,\n  Wizard,\n  WizardInput,\n} from './foundation.js';\nimport { getTheme } from './themes.js';\nimport { SupportedVersion } from './schemas.js';\n\nimport { Editing, newEmptySCD } from './Editing.js';\nimport { Logging } from './Logging.js';\nimport { Setting } from './Setting.js';\nimport { InstalledPlugin, Plugging, pluginIcons } from './Plugging.js';\nimport { Validating } from './Validating.js';\nimport { Waiting } from './Waiting.js';\nimport { Wizarding } from './Wizarding.js';\n\nimport { List } from '@material/mwc-list';\ninterface MenuItem {\n  icon: string;\n  name: string;\n  hint?: string;\n  actionItem?: boolean;\n  action?: (event: CustomEvent<ActionDetail>) => void;\n  disabled?: () => boolean;\n  content?: () => Promise<TemplateResult>;\n}\n\ninterface Triggered {\n  trigger: () => Promise<void>;\n}\n\n/** The `<open-scd>` custom element is the main entry point of the\n * Open Substation Configuration Designer. */\n@customElement('open-scd')\nexport class OpenSCD extends Setting(\n  Wizarding(Waiting(Validating(Plugging(Editing(Logging(LitElement))))))\n) {\n  /** The currently active editor tab. */\n  @property({ type: Number })\n  activeTab = 0;\n  private currentSrc = '';\n  /** The current file's URL. `blob:` URLs are *revoked after parsing*! */\n  @property({ type: String })\n  get src(): string {\n    return this.currentSrc;\n  }\n  set src(value: string) {\n    this.currentSrc = value;\n    this.dispatchEvent(newPendingStateEvent(this.loadDoc(value)));\n  }\n\n  @query('#menu') menuUI!: Drawer;\n  @query('#file-input') fileUI!: HTMLInputElement;\n  @query('#saveas') saveUI!: Dialog;\n\n  /** Loads and parses an `XMLDocument` after [[`src`]] has changed. */\n  private async loadDoc(src: string): Promise<void> {\n    this.reset();\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'info',\n        title: get('openSCD.loading', { name: this.docName }),\n      })\n    );\n\n    const response = await fetch(src);\n    const text = await response.text();\n    this.doc = new DOMParser().parseFromString(text, 'application/xml');\n\n    if (src.startsWith('blob:')) URL.revokeObjectURL(src);\n\n    const validated = this.validate(this.doc, { fileName: this.docName });\n\n    if (this.doc) this.dispatchEvent(newPendingStateEvent(validated));\n\n    await validated;\n\n    this.dispatchEvent(\n      newLogEvent({\n        kind: 'info',\n        title: get('openSCD.loaded', { name: this.docName }),\n      })\n    );\n    return;\n  }\n\n  /** Loads the file `event.target.files[0]` into [[`src`]] as a `blob:...`. */\n  private loadFile(event: Event): void {\n    const file =\n      (<HTMLInputElement | null>event.target)?.files?.item(0) ?? false;\n    if (file) {\n      this.docName = file.name;\n      this.setAttribute('src', URL.createObjectURL(file));\n    }\n  }\n\n  private saveAs(): void {\n    this.docName =\n      this.saveUI.querySelector('mwc-textfield')?.value || this.docName;\n    this.save();\n    this.saveUI.close();\n  }\n\n  private formatXml(xml: string, tab?: string) {\n    let formatted = '',\n      indent = '';\n\n    if (!tab) tab = '\\t';\n    xml.split(/>\\s*</).forEach(function (node) {\n      if (node.match(/^\\/\\w/)) indent = indent.substring(tab!.length);\n      formatted += indent + '<' + node + '>\\r\\n';\n      if (node.match(/^<?\\w[^>]*[^/]$/)) indent += tab;\n    });\n    return formatted.substring(1, formatted.length - 3);\n  }\n\n  private save(): void {\n    if (this.doc) {\n      const blob = new Blob(\n        [this.formatXml(new XMLSerializer().serializeToString(this.doc))],\n        {\n          type: 'application/xml',\n        }\n      );\n\n      const a = document.createElement('a');\n      a.download = this.docName;\n      a.href = URL.createObjectURL(blob);\n      a.dataset.downloadurl = ['application/xml', a.download, a.href].join(':');\n      a.style.display = 'none';\n      document.body.appendChild(a);\n      a.click();\n      document.body.removeChild(a);\n      setTimeout(function () {\n        URL.revokeObjectURL(a.href);\n      }, 1500);\n    }\n  }\n\n  private handleKeyPress(e: KeyboardEvent): void {\n    let handled = false;\n    const ctrlAnd = (key: string) =>\n      e.key === key && e.ctrlKey && (handled = true);\n\n    if (ctrlAnd('y')) this.redo();\n    if (ctrlAnd('z')) this.undo();\n    if (ctrlAnd('l')) this.logUI.open ? this.logUI.close() : this.logUI.show();\n    if (ctrlAnd('m')) this.menuUI.open = !this.menuUI.open;\n    if (ctrlAnd('o')) this.fileUI.click();\n    if (ctrlAnd('s')) this.save();\n    if (ctrlAnd('S')) this.saveUI.show();\n    if (ctrlAnd('P')) this.pluginUI.show();\n\n    if (handled) e.preventDefault();\n  }\n\n  private createNewProject(\n    inputs: WizardInput[],\n    wizard: Element\n  ): EditorAction[] {\n    this.docName = inputs[0].value.match(/\\.s[sc]d$/i)\n      ? inputs[0].value\n      : inputs[0].value + '.scd';\n    const version = <SupportedVersion>(\n      (<ListItemBase>wizard.shadowRoot!.querySelector('mwc-list')!.selected)\n        .value\n    );\n\n    this.reset();\n\n    this.doc = newEmptySCD(this.docName.slice(0, -4), version);\n\n    return [{ actions: [], title: get('menu.new'), derived: true }];\n  }\n\n  private newProjectWizard(): Wizard {\n    return [\n      {\n        title: get('menu.new'),\n        primary: {\n          icon: 'create_new_folder',\n          label: get('create'),\n          action: (inputs, wizard) => this.createNewProject(inputs, wizard),\n        },\n        content: [\n          html`<wizard-textfield\n              id=\"srcName\"\n              label=\"name\"\n              value=\"project.scd\"\n              required\n              dialogInitialFocus\n            ></wizard-textfield>\n            <mwc-list activatable>\n              <mwc-radio-list-item left value=\"2003\"\n                >Edition 1 (Schema 1.7)</mwc-radio-list-item\n              >\n              <mwc-radio-list-item left value=\"2007B\"\n                >Edition 2 (Schema 3.1)</mwc-radio-list-item\n              >\n              <mwc-radio-list-item left selected value=\"2007B4\"\n                >Edition 2.1 (2007B4)</mwc-radio-list-item\n              >\n            </mwc-list>`,\n        ],\n      },\n    ];\n  }\n\n  private openNewProjectWizard() {\n    this.dispatchEvent(newWizardEvent(this.newProjectWizard()));\n  }\n\n  get menu(): (MenuItem | 'divider')[] {\n    const items: (MenuItem | 'divider')[] = [];\n\n    this.items.forEach(plugin =>\n      items.push({\n        icon: plugin.icon || pluginIcons['triggered'],\n        name: plugin.name,\n        action: ae => {\n          this.dispatchEvent(\n            newPendingStateEvent(\n              (<Triggered>(\n                (<unknown>(\n                  (<List>ae.target).items[ae.detail.index].lastElementChild\n                ))\n              )).trigger()\n            )\n          );\n        },\n        disabled: (): boolean => this.doc === null,\n        content: plugin.content,\n      })\n    );\n\n    if (items.length > 0) items.push('divider');\n\n    return [\n      'divider',\n      {\n        icon: 'folder_open',\n        name: 'menu.open',\n        action: (): void => this.fileUI.click(),\n      },\n      {\n        icon: 'create_new_folder',\n        name: 'menu.new',\n        action: (): void => this.openNewProjectWizard(),\n      },\n      {\n        icon: 'save_alt',\n        name: 'save',\n        action: (): void => this.save(),\n        disabled: (): boolean => this.doc === null,\n      },\n      {\n        icon: 'save',\n        name: 'saveAs',\n        action: (): void => this.saveUI.show(),\n        disabled: (): boolean => this.doc === null,\n      },\n      'divider',\n      {\n        icon: 'undo',\n        name: 'undo',\n        actionItem: true,\n        action: this.undo,\n        disabled: (): boolean => !this.canUndo,\n      },\n      {\n        icon: 'redo',\n        name: 'redo',\n        actionItem: true,\n        action: this.redo,\n        disabled: (): boolean => !this.canRedo,\n      },\n      {\n        icon: 'rule_folder',\n        name: 'menu.validate',\n        action: () =>\n          this.doc\n            ? this.dispatchEvent(\n                newPendingStateEvent(\n                  this.validate(this.doc, { fileName: this.docName })\n                )\n              )\n            : null,\n        disabled: (): boolean => this.doc === null,\n      },\n      {\n        icon: 'rule',\n        name: 'menu.viewLog',\n        actionItem: true,\n        action: (): void => this.logUI.show(),\n      },\n      'divider',\n      ...items,\n      {\n        icon: 'settings',\n        name: 'settings.name',\n        action: (): void => this.settingsUI.show(),\n      },\n      {\n        icon: 'extension',\n        name: 'plugins.heading',\n        action: (): void => this.pluginUI.show(),\n      },\n    ];\n  }\n\n  constructor() {\n    super();\n\n    this.handleKeyPress = this.handleKeyPress.bind(this);\n    document.onkeydown = this.handleKeyPress;\n  }\n\n  renderMenuItem(me: MenuItem | 'divider'): TemplateResult {\n    if (me === 'divider')\n      return html`<li divider padded role=\"separator\"></li>`;\n    return html`\n      <mwc-list-item\n        iconid=\"${me.icon}\"\n        graphic=\"icon\"\n        .disabled=${me.disabled?.() || !me.action}\n        ><mwc-icon slot=\"graphic\">${me.icon}</mwc-icon>\n        <span>${translate(me.name)}</span>\n        ${me.hint\n          ? html`<span slot=\"secondary\"><tt>${me.hint}</tt></span>`\n          : ''}\n        ${me.content\n          ? until(\n              me.content(),\n              html`<mwc-linear-progress indeterminate></mwc-linear-progress>`\n            )\n          : ''}\n      </mwc-list-item>\n    `;\n  }\n\n  renderActionItem(me: MenuItem | 'divider'): TemplateResult {\n    if (me !== 'divider' && me.actionItem)\n      return html`<mwc-icon-button\n        slot=\"actionItems\"\n        icon=\"${me.icon}\"\n        label=\"${me.name}\"\n        ?disabled=${me.disabled?.() || !me.action}\n        @click=${me.action}\n      ></mwc-icon-button>`;\n    else return html``;\n  }\n\n  renderEditorTab({ name, icon }: InstalledPlugin): TemplateResult {\n    return html`<mwc-tab label=${translate(name)} icon=${icon || 'edit'}>\n    </mwc-tab>`;\n  }\n\n  render(): TemplateResult {\n    return html`\n      <mwc-drawer class=\"mdc-theme--surface\" hasheader type=\"modal\" id=\"menu\">\n        <span slot=\"title\">${translate('menu.name')}</span>\n        ${\n          this.docName ? html`<span slot=\"subtitle\">${this.docName}</span>` : ''\n        }\n        <mwc-list\n          wrapFocus\n          @action=${(ae: CustomEvent<ActionDetail>) =>\n            (<MenuItem>(\n              this.menu.filter(item => item !== 'divider')[ae.detail.index]\n            ))?.action?.(ae)}\n        > ${this.menu.map(this.renderMenuItem)}\n        </mwc-list>\n\n        <mwc-top-app-bar-fixed slot=\"appContent\">\n          <mwc-icon-button\n            icon=\"menu\"\n            label=\"Menu\"\n            slot=\"navigationIcon\"\n            @click=${() => (this.menuUI.open = true)}\n          ></mwc-icon-button>\n          <div slot=\"title\" id=\"title\">${this.docName}</div>\n          ${this.menu.map(this.renderActionItem)}\n          ${\n            this.doc\n              ? html`<mwc-tab-bar\n                  @MDCTabBar:activated=${(e: CustomEvent) =>\n                    (this.activeTab = e.detail.index)}\n                >\n                  ${this.editors.map(this.renderEditorTab)}\n                </mwc-tab-bar>`\n              : ``\n          }\n        </mwc-top-app-bar-fixed>\n      </mwc-drawer>\n\n      <mwc-dialog heading=\"${translate('saveAs')}\" id=\"saveas\">\n        <mwc-textfield dialogInitialFocus label=\"${translate(\n          'filename'\n        )}\" value=\"${this.docName}\">\n        </mwc-textfield>\n        <mwc-button\n          @click=${() => this.saveAs()}\n          icon=\"save\"\n          slot=\"primaryAction\">\n          ${translate('save')}\n        </mwc-button>\n        <mwc-button\n          dialogAction=\"cancel\"\n          style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\n          slot=\"secondaryAction\">\n          ${translate('cancel')}\n        </mwc-button>\n      </mwc-dialog>\n        \n      ${\n        this.doc\n          ? until(\n              this.editors[this.activeTab] &&\n                this.editors[this.activeTab].content(),\n              html`<mwc-linear-progress indeterminate></mwc-linear-progress>`\n            )\n          : html`<div class=\"landing\">\n              <mwc-icon-button\n                class=\"landing_icon\"\n                icon=\"create_new_folder\"\n                @click=${() => this.openNewProjectWizard()}\n              >\n                <div class=\"landing_label\">${translate('menu.new')}</div>\n              </mwc-icon-button>\n              <mwc-icon-button\n                class=\"landing_icon\"\n                icon=\"folder_open\"\n                @click=${() => this.fileUI.click()}\n              >\n                <div class=\"landing_label\">${translate('menu.open')}</div>\n              </mwc-icon-button>\n            </div>`\n      }\n\n      <input id=\"file-input\" type=\"file\" accept=\".scd,.ssd\" @click=${(\n        event: MouseEvent\n      ) => ((<HTMLInputElement>event.target).value = '')} @change=\"${\n      this.loadFile\n    }\"></input>\n      ${super.render()}\n      ${getTheme(this.settings.theme)}\n    `;\n  }\n\n  static styles = css`\n    mwc-top-app-bar-fixed {\n      --mdc-theme-text-disabled-on-light: rgba(255, 255, 255, 0.38);\n    } /* hack to fix disabled icon buttons rendering black */\n\n    mwc-tab {\n      background-color: var(--primary);\n      --mdc-theme-primary: var(--mdc-theme-on-primary);\n    }\n\n    input[type='file'] {\n      display: none;\n    }\n\n    mwc-dialog {\n      --mdc-dialog-max-width: 92vw;\n    }\n\n    mwc-dialog > form {\n      display: flex;\n      flex-direction: column;\n    }\n\n    mwc-dialog > form > * {\n      display: block;\n      margin-top: 16px;\n    }\n\n    mwc-circular-progress-four-color {\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      z-index: 99;\n      pointer-events: none;\n    }\n\n    tt {\n      font-family: 'Roboto Mono', monospace;\n      font-weight: 300;\n    }\n\n    .landing {\n      display: flex;\n      flex-direction: row;\n      justify-content: center;\n      position: absolute;\n      top: calc(50vh - 82px);\n      left: calc(50vw - 184px);\n    }\n\n    .landing_icon:hover {\n      box-shadow: 0 12px 17px 2px rgba(0, 0, 0, 0.14),\n        0 5px 22px 4px rgba(0, 0, 0, 0.12), 0 7px 8px -4px rgba(0, 0, 0, 0.2);\n    }\n\n    .landing_icon {\n      margin: 12px;\n      border-radius: 16px;\n      width: 160px;\n      height: 140px;\n      text-align: center;\n      color: var(--mdc-theme-on-secondary);\n      background: var(--secondary);\n      --mdc-icon-button-size: 100px;\n      --mdc-icon-size: 100px;\n      --mdc-ripple-color: rgba(0, 0, 0, 0);\n      box-shadow: rgb(0 0 0 / 14%) 0px 6px 10px 0px,\n        rgb(0 0 0 / 12%) 0px 1px 18px 0px, rgb(0 0 0 / 20%) 0px 3px 5px -1px;\n      transition: box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);\n    }\n\n    .landing_label {\n      width: 160px;\n      height: 50px;\n      margin-top: 100px;\n      margin-left: -30px;\n      font-family: 'Roboto', sans-serif;\n    }\n  `;\n}\n"]}