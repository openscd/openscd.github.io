{"version":3,"file":"wizard-dialog.js","sourceRoot":"","sources":["../../src/wizard-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  css,\n  queryAll,\n  LitElement,\n  property,\n  internalProperty,\n  TemplateResult,\n  html,\n} from 'lit-element';\nimport { get, translate } from 'lit-translate';\n\nimport { Dialog } from '@material/mwc-dialog';\nimport { List } from '@material/mwc-list';\n\nimport 'ace-custom-element';\nimport './wizard-textfield.js';\nimport {\n  newActionEvent,\n  Wizard,\n  WizardInput,\n  WizardPage,\n  newWizardEvent,\n  WizardActor,\n  wizardInputSelector,\n  isWizard,\n  checkValidity,\n  reportValidity,\n  Delete,\n  Create,\n  identity,\n} from './foundation.js';\n\nfunction dialogInputs(dialog?: Dialog): WizardInput[] {\n  return Array.from(dialog?.querySelectorAll(wizardInputSelector) ?? []);\n}\n\nfunction dialogValid(dialog?: Dialog): boolean {\n  return dialogInputs(dialog).every(checkValidity);\n}\n\nfunction codeAction(element: Element): WizardActor {\n  return inputs => {\n    const text = inputs[0].value!;\n    if (!text || !element.parentElement) return [];\n    const desc = {\n      parent: element.parentElement!,\n      reference: element.nextSibling,\n      element,\n    };\n    const del: Delete = {\n      old: desc,\n      checkValidity: () => true,\n    };\n    const cre: Create = {\n      new: {\n        ...desc,\n        element: new DOMParser().parseFromString(text, 'application/xml')\n          .documentElement,\n      },\n      checkValidity: () => true,\n    };\n    return [\n      {\n        actions: [del, cre],\n        title: get('code.log', {\n          id: identity(element),\n        }),\n      },\n    ];\n  };\n}\n\n/** A wizard style dialog consisting of several pages commiting some\n * [[`EditorAction`]] on completion and aborting on dismissal. */\n@customElement('wizard-dialog')\nexport class WizardDialog extends LitElement {\n  /** The [[`Wizard`]] implemented by this dialog. */\n  @property({ type: Array })\n  wizard: Wizard = [];\n  /** Index of the currently active [[`WizardPage`]] */\n  @internalProperty()\n  pageIndex = 0;\n\n  @queryAll('mwc-dialog')\n  dialogs!: NodeListOf<Dialog>;\n  @queryAll(wizardInputSelector)\n  inputs!: NodeListOf<WizardInput>;\n\n  /** The `Dialog` showing the active [[`WizardPage`]]. */\n  get dialog(): Dialog | undefined {\n    return this.dialogs[this.pageIndex];\n  }\n\n  get code(): boolean {\n    return (\n      (this.dialog?.querySelector('mwc-icon-button-toggle')?.on ?? false) &&\n      localStorage.getItem('mode') === 'pro'\n    );\n  }\n\n  /** Checks the inputs of all [[`WizardPage`]]s for validity. */\n  checkValidity(): boolean {\n    return Array.from(this.inputs).every(checkValidity);\n  }\n\n  private get firstInvalidPage(): number {\n    return Array.from(this.dialogs).findIndex(dialog => !dialogValid(dialog));\n  }\n\n  prev(): void {\n    if (this.pageIndex > 0) this.pageIndex--;\n  }\n  async next(): Promise<void> {\n    if (dialogValid(this.dialog)) {\n      if (this.wizard.length > this.pageIndex + 1) this.pageIndex++;\n    } else {\n      this.dialog?.show();\n      await this.dialog?.updateComplete;\n      dialogInputs(this.dialog).map(reportValidity);\n    }\n  }\n\n  /** Commits `action` if all inputs are valid, reports validity otherwise. */\n  async act(action?: WizardActor, primary = true): Promise<boolean> {\n    if (action === undefined) return false;\n    const wizardInputs = Array.from(this.inputs);\n    const wizardList = <List | null>(\n      this.dialog?.querySelector('filtered-list,mwc-list')\n    );\n    if (!this.checkValidity()) {\n      this.pageIndex = this.firstInvalidPage;\n      wizardInputs.map(reportValidity);\n      return false;\n    }\n\n    const wizardActions = action(wizardInputs, this, wizardList);\n    if (wizardActions.length > 0) {\n      if (primary) this.wizard[this.pageIndex].primary = undefined;\n      else this.wizard[this.pageIndex].secondary = undefined;\n      this.dispatchEvent(newWizardEvent());\n    }\n    wizardActions.forEach(wa =>\n      isWizard(wa)\n        ? this.dispatchEvent(newWizardEvent(wa()))\n        : this.dispatchEvent(newActionEvent(wa))\n    );\n    return true;\n  }\n\n  private onClosed(ae: CustomEvent<{ action: string } | null>): void {\n    if (!(ae.target instanceof Dialog && ae.detail?.action)) return;\n    if (ae.detail.action === 'close') this.dispatchEvent(newWizardEvent());\n    else if (ae.detail.action === 'prev') this.prev();\n    else if (ae.detail.action === 'next') this.next();\n  }\n\n  constructor() {\n    super();\n\n    this.act = this.act.bind(this);\n    this.renderPage = this.renderPage.bind(this);\n  }\n\n  updated(changedProperties: Map<string | number | symbol, unknown>): void {\n    if (changedProperties.has('wizard')) {\n      this.pageIndex = 0;\n      while (\n        this.wizard.findIndex(page => page.initial) > this.pageIndex &&\n        dialogValid(this.dialog)\n      ) {\n        this.dialog?.close();\n        this.next();\n      }\n      this.dialog?.show();\n    }\n    if (this.wizard[this.pageIndex]?.primary?.auto) {\n      this.updateComplete.then(() =>\n        this.act(this.wizard[this.pageIndex].primary!.action)\n      );\n    }\n  }\n\n  renderPage(page: WizardPage, index: number): TemplateResult {\n    return html`<mwc-dialog\n      defaultAction=\"close\"\n      ?open=${index === this.pageIndex}\n      heading=${page.title}\n      @closed=${this.onClosed}\n    >\n      ${page.element && localStorage.getItem('mode') === 'pro'\n        ? html`<mwc-icon-button-toggle\n            onicon=\"code\"\n            officon=\"code_off\"\n            @click=${() => this.requestUpdate()}\n          ></mwc-icon-button-toggle>`\n        : ''}\n      <div id=\"wizard-content\">\n        ${this.code && page.element\n          ? html`<ace-editor\n              base-path=\"/public/ace\"\n              wrap\n              soft-tabs\n              style=\"width: 80vw; height: calc(100vh - 240px);\"\n              theme=\"ace/theme/solarized_${localStorage.getItem('theme')}\"\n              mode=\"ace/mode/xml\"\n              value=\"${new XMLSerializer().serializeToString(page.element)}\"\n            ></ace-editor>`\n          : page.content}\n      </div>\n      ${index > 0\n        ? html`<mwc-button\n            slot=\"secondaryAction\"\n            dialogAction=\"prev\"\n            icon=\"navigate_before\"\n            label=${this.wizard?.[index - 1].title}\n          ></mwc-button>`\n        : html``}\n      ${page.secondary\n        ? html`<mwc-button\n            slot=\"secondaryAction\"\n            @click=${() => this.act(page.secondary?.action, false)}\n            icon=\"${page.secondary.icon}\"\n            label=\"${page.secondary.label}\"\n          ></mwc-button>`\n        : html`<mwc-button\n            slot=\"secondaryAction\"\n            dialogAction=\"close\"\n            label=\"${translate('cancel')}\"\n            style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\n          ></mwc-button>`}\n      ${this.code && page.element\n        ? html`<mwc-button\n            slot=\"primaryAction\"\n            @click=${() => this.act(codeAction(page.element!))}\n            icon=\"code\"\n            label=\"${translate('save')}\"\n            trailingIcon\n            dialogInitialFocus\n          ></mwc-button>`\n        : page.primary\n        ? html`<mwc-button\n            slot=\"primaryAction\"\n            @click=${() => this.act(page.primary?.action)}\n            icon=\"${page.primary.icon}\"\n            label=\"${page.primary.label}\"\n            trailingIcon\n            dialogInitialFocus\n          ></mwc-button>`\n        : index + 1 < (this.wizard?.length ?? 0)\n        ? html`<mwc-button\n            slot=\"primaryAction\"\n            dialogAction=\"next\"\n            icon=\"navigate_next\"\n            label=${this.wizard?.[index + 1].title}\n            trailingicon\n          ></mwc-button>`\n        : html``}\n    </mwc-dialog>`;\n  }\n\n  render(): TemplateResult {\n    return html`${this.wizard.map(this.renderPage)}`;\n  }\n\n  static styles = css`\n    mwc-dialog {\n      --mdc-dialog-max-width: 92vw;\n    }\n\n    mwc-dialog > mwc-icon-button-toggle {\n      position: absolute;\n      top: 8px;\n      right: 14px;\n      color: var(--base00);\n    }\n\n    mwc-dialog > mwc-icon-button-toggle[on] {\n      color: var(--mdc-theme-primary);\n    }\n\n    #wizard-content {\n      display: flex;\n      flex-direction: column;\n    }\n\n    #wizard-content > * {\n      display: block;\n      margin-top: 16px;\n    }\n\n    *[iconTrailing='search'] {\n      --mdc-shape-small: 28px;\n    }\n  `;\n}\n"]}