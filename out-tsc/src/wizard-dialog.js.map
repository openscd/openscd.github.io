{"version":3,"file":"wizard-dialog.js","sourceRoot":"","sources":["../../src/wizard-dialog.ts"],"names":[],"mappings":"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","sourcesContent":["import {\n  customElement,\n  css,\n  queryAll,\n  LitElement,\n  property,\n  internalProperty,\n  TemplateResult,\n  html,\n} from 'lit-element';\nimport { translate } from 'lit-translate';\n\nimport '@material/mwc-button';\nimport '@material/mwc-dialog';\nimport { Dialog } from '@material/mwc-dialog';\n\nimport './wizard-textfield.js';\nimport {\n  newActionEvent,\n  Wizard,\n  WizardInput,\n  WizardPage,\n  newWizardEvent,\n  WizardAction,\n  wizardInputSelector,\n} from './foundation.js';\n\nfunction dialogInputs(dialog?: Dialog): WizardInput[] {\n  return Array.from(dialog?.querySelectorAll(wizardInputSelector) ?? []);\n}\n\nfunction dialogValid(dialog?: Dialog): boolean {\n  return dialogInputs(dialog).every(wi => wi.checkValidity());\n}\n\n@customElement('wizard-dialog')\nexport class WizardDialog extends LitElement {\n  @property()\n  wizard: Wizard = [];\n  @internalProperty()\n  pageIndex = 0;\n  @queryAll('mwc-dialog')\n  dialogs!: NodeListOf<Dialog>;\n  @queryAll(wizardInputSelector)\n  inputs!: NodeListOf<WizardInput>;\n\n  get dialog(): Dialog | undefined {\n    return this.dialogs[this.pageIndex];\n  }\n\n  checkValidity(): boolean {\n    return Array.from(this.inputs).every(wi => wi.checkValidity());\n  }\n\n  get firstInvalidPage(): number {\n    return Array.from(this.dialogs).findIndex(dialog => !dialogValid(dialog));\n  }\n\n  prev(): void {\n    if (this.pageIndex > 0) this.pageIndex--;\n  }\n\n  async next(): Promise<void> {\n    if (dialogValid(this.dialog)) {\n      if (this.wizard.length > this.pageIndex + 1) this.pageIndex++;\n    } else {\n      this.dialog?.show();\n      await this.dialog?.updateComplete;\n      dialogInputs(this.dialog).map(wi => wi.reportValidity());\n    }\n  }\n\n  close(): void {\n    this.dispatchEvent(newWizardEvent());\n  }\n\n  async act(action?: WizardAction): Promise<boolean> {\n    if (action === undefined) return false;\n    const inputArray = Array.from(this.inputs);\n    if (!this.checkValidity()) {\n      this.pageIndex = this.firstInvalidPage;\n      inputArray.map(wi => wi.reportValidity());\n      return false;\n    }\n    action(inputArray, this).map(ea => this.dispatchEvent(newActionEvent(ea)));\n    return true;\n  }\n\n  onClosed(ae: CustomEvent<{ action: string } | null>): void {\n    if (!(ae.target instanceof Dialog && ae.detail?.action)) return;\n    if (ae.detail.action === 'close') this.close();\n    else if (ae.detail.action === 'prev') this.prev();\n    else if (ae.detail.action === 'next') this.next();\n  }\n\n  constructor() {\n    super();\n\n    this.act = this.act.bind(this);\n    this.renderPage = this.renderPage.bind(this);\n  }\n\n  renderPage(page: WizardPage, index: number): TemplateResult {\n    return html`<mwc-dialog\n      defaultAction=\"none\"\n      ?open=${index === this.pageIndex}\n      heading=${page.title}\n      @closed=${this.onClosed}\n    >\n      <div id=\"wizard-content\">${page.content}</div>\n      ${index > 0\n        ? html`<mwc-button\n            slot=\"secondaryAction\"\n            dialogAction=\"prev\"\n            icon=\"navigate_before\"\n            label=${this.wizard?.[index - 1].title}\n          ></mwc-button>`\n        : html``}\n      ${page.secondary\n        ? html`<mwc-button\n            slot=\"secondaryAction\"\n            @click=${() => this.act(page.secondary?.action)}\n            icon=\"${page.secondary.icon}\"\n            label=\"${page.secondary.label}\"\n            outlined\n          ></mwc-button>`\n        : html`<mwc-button\n            slot=\"secondaryAction\"\n            dialogAction=\"close\"\n            label=\"${translate('cancel')}\"\n            style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\n          ></mwc-button>`}\n      ${page.primary\n        ? html`<mwc-button\n            slot=\"primaryAction\"\n            @click=${() => this.act(page.primary?.action)}\n            icon=\"${page.primary.icon}\"\n            label=\"${page.primary.label}\"\n            trailingIcon\n            unelevated\n          ></mwc-button>`\n        : index + 1 < (this.wizard?.length ?? 0)\n        ? html`<mwc-button\n            slot=\"primaryAction\"\n            dialogAction=\"next\"\n            icon=\"navigate_next\"\n            label=${this.wizard?.[index + 1].title}\n            trailingicon\n          ></mwc-button>`\n        : html``}\n    </mwc-dialog>`;\n  }\n\n  render(): TemplateResult {\n    return html`${this.wizard.map(this.renderPage)}`;\n  }\n\n  static styles = css`\n    mwc-dialog {\n      --mdc-dialog-max-width: 92vw;\n    }\n\n    #wizard-content {\n      display: flex;\n      flex-direction: column;\n    }\n\n    #wizard-content > * {\n      display: block;\n      margin-top: 16px;\n    }\n  `;\n}\n"]}