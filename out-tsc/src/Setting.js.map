{"version":3,"file":"Setting.js","sourceRoot":"","sources":["../../src/Setting.ts"],"names":[],"mappings":"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","sourcesContent":["import { html, property, query, TemplateResult } from 'lit-element';\nimport { registerTranslateConfig, translate, use } from 'lit-translate';\n\nimport { Dialog } from '@material/mwc-dialog';\nimport { Select } from '@material/mwc-select';\nimport { Switch } from '@material/mwc-switch';\n\nimport { ifImplemented, LitElementConstructor, Mixin } from './foundation.js';\nimport { Language, languages, loader } from './translations/loader.js';\nimport { WizardDialog } from './wizard-dialog.js';\n\nexport type Settings = {\n  language: Language;\n  theme: 'light' | 'dark';\n  mode: 'safe' | 'pro';\n  showieds: 'on' | 'off';\n};\nexport const defaults: Settings = {\n  language: 'en',\n  theme: 'light',\n  mode: 'safe',\n  showieds: 'off',\n};\n\n/** Mixin that saves [[`Settings`]] to `localStorage`, reflecting them in the\n * `settings` property, setting them through `setSetting(setting, value)`. */\nexport type SettingElement = Mixin<typeof Setting>;\n\nexport function Setting<TBase extends LitElementConstructor>(Base: TBase) {\n  class SettingElement extends Base {\n    /** Current [[`Settings`]] in `localStorage`, default to [[`defaults`]]. */\n    @property()\n    get settings(): Settings {\n      return {\n        language: this.getSetting('language'),\n        theme: this.getSetting('theme'),\n        mode: this.getSetting('mode'),\n        showieds: this.getSetting('showieds'),\n      };\n    }\n\n    @query('#settings')\n    settingsUI!: Dialog;\n    @query('#language')\n    languageUI!: Select;\n    @query('#dark')\n    darkThemeUI!: Switch;\n    @query('#mode')\n    modeUI!: Switch;\n    @query('#showieds')\n    showiedsUI!: Switch;\n\n    private getSetting<T extends keyof Settings>(setting: T): Settings[T] {\n      return (\n        <Settings[T] | null>localStorage.getItem(setting) ?? defaults[setting]\n      );\n    }\n    /** Update the `value` of `setting`, storing to `localStorage`. */\n    setSetting<T extends keyof Settings>(setting: T, value: Settings[T]): void {\n      localStorage.setItem(setting, <string>(<unknown>value));\n      this.shadowRoot\n        ?.querySelector<WizardDialog>('wizard-dialog')\n        ?.requestUpdate();\n      this.requestUpdate();\n    }\n\n    private onClosing(ae: CustomEvent<{ action: string } | null>): void {\n      if (ae.detail?.action === 'reset') {\n        Object.keys(this.settings).forEach(item =>\n          localStorage.removeItem(item)\n        );\n        this.requestUpdate('settings');\n      } else if (ae.detail?.action === 'save') {\n        this.setSetting('language', <Language>this.languageUI.value);\n        this.setSetting('theme', this.darkThemeUI.checked ? 'dark' : 'light');\n        this.setSetting('mode', this.modeUI.checked ? 'pro' : 'safe');\n        this.setSetting('showieds', this.showiedsUI.checked ? 'on' : 'off');\n        this.requestUpdate('settings');\n      }\n    }\n\n    updated(changedProperties: Map<string | number | symbol, unknown>): void {\n      super.updated(changedProperties);\n      if (changedProperties.has('settings')) use(this.settings.language);\n    }\n\n    constructor(...params: any[]) {\n      super(...params);\n\n      registerTranslateConfig({ loader, empty: key => key });\n      use(this.settings.language);\n    }\n\n    render(): TemplateResult {\n      return html`${ifImplemented(super.render())}\n        <mwc-dialog\n          id=\"settings\"\n          heading=\"${translate('settings.title')}\"\n          @closing=${this.onClosing}\n        >\n          <form>\n            <mwc-select\n              fixedMenuPosition\n              id=\"language\"\n              icon=\"language\"\n              label=\"${translate('settings.language')}\"\n            >\n              ${Object.keys(languages).map(\n                lang =>\n                  html`<mwc-list-item\n                    graphic=\"icon\"\n                    value=\"${lang}\"\n                    ?selected=${lang === this.settings.language}\n                    >${translate(`settings.languages.${lang}`)}</mwc-list-item\n                  >`\n              )}\n            </mwc-select>\n            <mwc-formfield label=\"${translate('settings.dark')}\">\n              <mwc-switch\n                id=\"dark\"\n                ?checked=${this.settings.theme === 'dark'}\n              ></mwc-switch>\n            </mwc-formfield>\n            <mwc-formfield label=\"${translate('settings.mode')}\">\n              <mwc-switch\n                id=\"mode\"\n                ?checked=${this.settings.mode === 'pro'}\n              ></mwc-switch>\n            </mwc-formfield>\n            <mwc-formfield label=\"${translate('settings.showieds')}\">\n              <mwc-switch\n                id=\"showieds\"\n                ?checked=${this.settings.showieds === 'on'}\n              ></mwc-switch>\n            </mwc-formfield>\n          </form>\n          <mwc-button slot=\"secondaryAction\" dialogAction=\"close\">\n            ${translate('cancel')}\n          </mwc-button>\n          <mwc-button\n            style=\"--mdc-theme-primary: var(--mdc-theme-error)\"\n            slot=\"secondaryAction\"\n            dialogAction=\"reset\"\n          >\n            ${translate('reset')}\n          </mwc-button>\n          <mwc-button\n            icon=\"save\"\n            trailingIcon\n            slot=\"primaryAction\"\n            dialogAction=\"save\"\n          >\n            ${translate('save')}\n          </mwc-button>\n        </mwc-dialog>`;\n    }\n  }\n\n  return SettingElement;\n}\n"]}